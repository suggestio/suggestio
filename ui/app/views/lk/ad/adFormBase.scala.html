@(title: String, adnNode: MAdnNode, madOpt: Option[MAd] = None, bottomLeft: Option[Html] = None)(content: Html)(implicit ctx: Context)

@* Страница с внешней версткой для формы _adFormTpl. *@

@import ctx.messages

@lk.lkBase(
  title         = title,
  nodeOpt       = Some(adnNode),
  leftCurrEl    = Some(LkLeftPanelLinks.LPL_ADS)
) {

  <div class="viewport">
    <article class="page_cnt __ad-editor">
      <h1 class="page_title">@title</h1>
      @content

      @* Снизу отображаются кнопки общего управления карточкой в целом. *@
      <div class="submit-w __size-M">
        @bottomLeft
        <div class="f-right save-btn">
          <a class="btn __size-M __major js-submit-btn" data-for="#promoOfferForm">@messages("Save")</a>
        </div>
        <div class="f-right preview-btn">
          <a class="btn __size-M __minor js-ad-preview-button">@messages("Preview")</a>
        </div>
      </div>

    </article>
  </div>

  <script src="@routes.Assets.versioned("javascripts/lib/tinymce/js/tinymce/tinymce.min.js")"></script>

  <script>
    var ws = new WebSocket("@ctx.wsUrlPrefix@routes.MarketAd.ws(ctx.ctxIdStr)");

    ws.onmessage = function (evt) {
      var received_msg = evt.data;
      $(".js-color-block").remove();
      received_msg = $.parseJSON(received_msg);
      var colors = received_msg["data"];

      $("#adBgColor").val(colors[0]);

      $dom = $("#adFormDescriptionTable td:first");
      html = "<div class='color-block_lst'>";
      for(index in colors) {
        color = colors[index];
        html += "<div class='color-block js-color-block' data-color='"+color+"' style='background-color: #"+color+";'></div>"
      }
      html += "</div>";
      $dom.append(html);
    };

    tinymce.init({
      selector: 'textarea.js-tinymce',
      width: 660,
      height: 300,
      menubar: false,
      statusbar: false,
      plugins: 'link, textcolor, paste, colorpicker',
      toolbar: ["styleselect | fontsizeselect | alignleft aligncenter alignright | bold italic | colorpicker | link | removeformat"],
      content_css: '@routes.Assets.versioned("stylesheets/market/descr.css")',
      fontsize_formats: '@blk.FontSizes.values.iterator.map {fs =>@{fs.size}px@if(!fs.isLast){ }}',
      style_formats: @Html(blk.Fonts.valuesJsonTinyMce.toString),
      @if(messages.lang.language != "en") {
        @defining( messages.lang.toLocale ) { locale =>
          language: '@{locale.getCountry}_@{locale.getLanguage}',
        }
      }
      font_size_style_values: '1px,2px',
      setup: function(editor) {
        return editor.on('init', function(e) {
          return market.ad_form.set_descr_editor_bg();
        });
      }
    });
  </script>
}
