@(title: String, leftCurrEl: Option[LkLeftPanelLink] = None, nodeOpt: Option[MAdnNode] = None,
  headAfter:Option[Html] = None, popupContent: Option[Html] = None,
  povAdnId: Option[String] = None, showSwitchNodeBtn: Boolean = true)(content: Html)(implicit ctx: Context)

@* Базовый шаблон для личного кабинета sio-маркета (не важно: ТЦ или магазин). *@

@import ctx._
@import stuff._
@import LkLeftPanelLinks._

<!DOCTYPE html>
<html>
<head>
  <title>@title @if(nodeOpt){ | } @_nodeTitleTpl(nodeOpt) | Suggest.io</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("javascripts/lib/colorpicker/css/colorpicker.css")'/>

  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/lk/common.css")'/>
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/showcase.css")'/>
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/showcase_previews.css")'/>

  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/lk_new-design/lk.css")'/>

  <script src='@routes.Assets.versioned("javascripts/jquery.min.js")'></script>

  @static._faviconTpl()

  @headAfter
</head>

@defining( nodeOpt.flatMap(_.id)) { adnIdOpt =>
<body class="lk">

    <header class="header">
      <a class="header_logo-link" href="@routes.MarketLkAdn.lkList(fromNode = nodeOpt.flatMap(_.id))">
        <img class="header_logo-image" src='@routes.Assets.versioned("images/market/new-design/logo_retina.png")' alt="logo" width="53" height="51"/>
      </a>

      <div class="header_cnt">

        @if(nodeOpt.isEmpty) {
          <img class="header_logo-text" src='@routes.Assets.versioned("images/market/index/logo_retina.png")' width="101" height="26"/>
        } else {
          @nodeOpt.map { node =>
            <span class="header_logo-text">@node.meta.name</span>
          }
        }

        @adnIdOpt.map { adnId =>
          @* Виджет для отображения денег на счете и доступа к финансовым функциям. Только в контексте узла. *@
          @billing._billBallanceWidgetTpl(adnId)
        }
      </div>

      @if(showSwitchNodeBtn) {
        <a class="btn __size-M __major header_change-node" href="@routes.MarketLkAdn.lkList(fromNode = nodeOpt.flatMap(_.id))">@Messages("Switch.shop")</a>
      }

    </header>


    <section class="page">

      @* Отрендерить уведомления, которые появляются после сабмитов с последующими редиректами. *@
      @ctx.flashMap.map { case (flashStatus, flashMsg) =>
        <div style="display: none;" class="status-bar ft-L __@if(flashStatus == "success") {good} else {bad}">
          <div class="status-bar_cnt">
            @flashMsg
          </div>
        </div>
      }

      <aside class="left-bar">
        @adnIdOpt.map { adnId =>
          <nav class="left-bar_menu">
            <a class="left-bar_menu-i __cards@if(leftCurrEl contains LPL_ADS){ __act}" href="@routes.MarketLkAdn.showNodeAds(adnId, povAdnId = povAdnId)" title="@Messages("Ad.cards")"></a>
            <hr class="delimiter"/>
            <a class="left-bar_menu-i __profile@if(leftCurrEl contains LPL_NODE){ __act}"  href="@routes.MarketLkAdn.showAdnNode(adnId, povAdnId = povAdnId)" title="@Messages("Profile")"></a>
            <hr class="delimiter"/>
            @if(ctx.billBalanceOpt) {
              <a class="left-bar_menu-i __billing@if(leftCurrEl contains LPL_BILLING){ __act}" href="@routes.MarketLkBilling.showAdnNodeBilling(adnId)" title="@Messages("Billing")"></a>
              <hr class="delimiter"/>
            }
            <a class="left-bar_menu-i __events@if(leftCurrEl contains LPL_EVENTS){ __act}" href="@routes.LkEvents.nodeIndex(adnId)" title="@Messages("Events")">
              @* Вывести блямбу с кол-вом непрочитанных сообщений. *@
              @ctx.nodeUnseenEvtsCnt.map { cnt =>
                @if(cnt > 0) {
                  <span class="left-bar_menu-bubble" title="Новых событий: @cnt">@cnt</span>
                }
              }
            </a>
            <hr class="delimiter"/>
          </nav>
        }
        <div class="left-bar_bottom">
          <a class="left-bar_exit js-btn" href="#logoutPopup">@Messages("Logout")</a>
          <hr class="delimiter"/>
          <a class="left-bar_help">@Messages("Help")</a>
        </div>
      </aside>

      @content

    </section>


  <aside class="popups popups-container" id="popupsContainer">

    <div class="popup js-popup __size-M js-hidden" id="logoutPopup">
      <div class="popup_header">
        <a class="close f-right js-close-popup" href="#"></a>
      </div>
      <h2 class="minor-title">@Messages("Logout.suggest.io")</h2>
      <div class="btn-w __size-M">
        <a class="btn __minor __size-M js-close-popup">@Messages("Cancel")</a>
        <a class="btn __major __size-M __list" href="@routes.Ident.logout">@Messages("Logout")</a>
      </div>
    </div>

    @popupContent
  </aside>


  <script src="@routes.Assets.versioned("javascripts/market/lk/mx_cof.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/market/lk/mx_dev.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/lib/colorpicker/js/colorpicker.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/jquery-ui.custom.min.js")"></script>

</body>
}
</html>
