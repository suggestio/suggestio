@(args: adv.geo.tag.IForAdTplArgs)(middle: Html)(implicit ctx: Context)

@* Шаблон формы размещения карточки в тегах с географией. *@

@import ctx.{messages, request}
@import helper._
@import util.FC.tdRadialFc
@import io.suggest.common.maps.rad.RadMapConstants._
@import stuff._inputHiddenTpl
@import stuff.geo._
@import lk.tag.edit._
@import lk.adv.widgets._
@import io.suggest.adv.geo.tag.AgtFormConsts._

@_barTpl(MHands.Left) {
  @* js-форма добавления тегов. *@
  @_addFormTpl(args.form)

  @* Кнопка добавления тега. Вне формы, т.к. форма перезаписывается после сабмитов. *@
  @_addBtnTpl()
}

@form( CSRF(routes.LkAdvGeoTag.forAdSubmit(args.mad.id.get)), 'id -> FORM_ID) {

  @_barTpl(MHands.Left) {
    @* Рендер сохранённых тегов. *@
    @_existTagsContTpl() {
      @_tagsExistTpl(args.form)
    }
  }

  @_barTpl(MHands.Right) {
    @period._contTpl() {
      @period._formTpl(args.form("period"), args.advPeriodsAvail)
      @for(v <- args.form.value) {
        @period._reportTpl(v.dates)
      }
    }
  }


  @* Для сохранения и восстановления состояния карты при POST нужны hidden-поля в рамках формы. *@

  @defining( args.form("map") ) { mf =>

    @defining( mf("state") ) { sf =>
      @_hiddenLatLonTpl(
        f = sf("center"),
        latId = Some(INPUT_ID_LAT),
        lonId = Some(INPUT_ID_LON)
      )

      @* Состояние зума карты. *@
      @_inputHiddenTpl(
        sf("zoom"),
        id = Some(INPUT_ID_ZOOM)
      )
    }

    @* Сохранение данных круга на карте (области) присходит здесь. *@
    @defining( mf("circle") ) { cf =>
      @_hiddenLatLonTpl(
        cf("center"),
        latId = Some(INPUT_ID_CIRCLE_LAT),
        lonId = Some(INPUT_ID_CIRCLE_LON)
      )
      @_inputHiddenTpl(
        cf("radius"),
        id = Some(INPUT_ID_CIRCLE_RADIUS)
      )
    }
  }


  @* Какой-то контент внутри формы после тегов. Карта например. *@
  @middle

}
