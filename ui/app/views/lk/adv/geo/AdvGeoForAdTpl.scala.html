@(args: adv.geo.tag.IForAdTplArgs)(implicit ctx: Context)

@* Страница со формой размещения рекламной карточки на внешних сервисах. *@

@import ctx.messages
@import views.js.stuff.jsRevRouterTpl
@import views.html.stuff.jsTpl2HtmlTpl
@import stuff.geo.maps._
@import lk.adv.geo.agBase
@import lk.adv.widgets._
@import lk.lkwdgts.price._
@import io.suggest.adv.geo.AdvGeoConstants._
@import adv.tpl._
@import io.suggest.common.spa.SpaConst.STATE_CONT_ID
@import views.html.stuff._preLoaderLkTpl

@agBase(
  title       = messages("Adv.in.geo.tags"),
  mnode       = args.producer,
  mad         = args.mad,
  rightLink   = LkAdvRightLinks.TAGS_GEO,
  rightAfter  = Some( _rightPriceTpl(args.price, formId = FORM_ID) )
) {

  @* Скрытый рендер как-то сериализованного состояния формы. *@
  <input type="hidden" id="@STATE_CONT_ID" value="@args.formState"/>

  <div id="xynta">
    @_preLoaderLkTpl()
  </div>


  @* TODO Удалить и вычистить всё, что ниже: *@
  <br/>
  <br/>
  <br/>


  @_advFormBlockTpl() {

    @* Рендер самой формы здесь. *@
    @_AdvGeoFormTpl(args)

    @* Контейнер карты. *@
    <br/>
    @_mapContTpl()

  }


  @* Рендерим маркеры, необходимые rad-map карте. *@
  @_mapMarkersContTpl() {

    @* Нужен pin-маркер для центра круга. *@
    @_mapMarkersPinTpl()

    @* Нужен маркер для задания радиуса круга покрытия. *@
    @_mapMarkersRadTpl()

  }


  @* Рендер скрытой инфы по текущим размещения. *@
  <input type="hidden" id="@CurrShapes.DATA_CONTAINER_ID" value="@args.currAdvsJson"/>

  @* Рендер скрытой ссылки на наполнение карты узлами-ресиверами. *@
  @for(adId <- args.mad.id) {
    <input type="hidden" id="@AD_ID_INPUT_ID" value="@adId"/>
  }

  @* При добавлении тегов запросы add-tag-формы отправляются сюда. *@
  @jsTpl2HtmlTpl( withScriptTag = true )(
    jsRevRouterTpl("jsRoutes", csrfAll = true)(
      routes.javascript.LkAdvGeo.tagEditorAddTag,
      routes.javascript.LkAdvGeo.tagsSearch,
      routes.javascript.LkAdvGeo.tagsSearch2,

      routes.javascript.LkAdvGeo.getPriceSubmit,
      routes.javascript.LkAdvGeo.forAdSubmit,

      routes.javascript.LkAdvGeo.advRcvrsMap,
      routes.javascript.LkAdvGeo.rcvrMapPopup,

      routes.javascript.LkAdvGeo.currGeoAdvsMap
    )
  )

}
