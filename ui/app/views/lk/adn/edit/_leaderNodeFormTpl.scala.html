@(adnId:String, btnText: String, mf: Form[_], submitCall:Call, welcomeAdOpt: Option[MAdT],
  nodeInfo: AdNetMemberInfo)(implicit ctx: Context)

@* Форма для создания/редактирования торгового центра через личный кабинет. *@
@import helper._
@import util.FC.tdRadialFc
@import util.img.GalleryUtil.GALLERY_LEN_MAX
@import util.img.DynImgUtil
@import ctx._
@import io.suggest.vlines.VLines

@form(CSRF(submitCall), 'id -> "profileEdit") {

  <div class="profile_logo-bar" id="logo">
    @defining(mf("logoImgId").value) { logoImgIdOpt =>
      @logoImgIdOpt.filter(!_.isEmpty).map { imgId =>
        <style class="custom-color-style" data-for=".__logo">
          .__logo {
            background-color: #@mf("meta.color").value;
          }
        </style>
        <div class="image __logo __size-L js-preview">
          <input class="js-image-key" type="hidden" name="logoImgId" value="@logoImgIdOpt"/>
          <img class="image_src" src="@DynImgUtil.imgCall(imgId)"/>
          <a class="image_remove-btn js-remove-image" title="@messages("Delete")">
            <span></span>
          </a>
        </div>
      }

      <div class="image __size-L js-image-upload"@if(!logoImgIdOpt.isEmpty) { style="display: none;"}>
        @stuff._fileUploadTpl(
          call          = routes.MarketLkAdnEdit.handleTempLogo(),
          fieldName     = "logoImgId",
          previewRoot   = "#logo",
          previewClass  = "__logo __size-L"
        )
        <a class="image_add-btn js-file-upload-btn" title="@messages("Upload.logo", " ")">
         <span>@Html( messages("Upload.logo", "<br/>") )</span>
        </a>
      </div>

    }
  </div>

  <div class="profile_info-bar">
    <hr class="delimiter __light"/>

    @mf.globalError.map { errors =>
      <p class="block __margin-M red">@messages("Error"): @messages(errors.message)</p>
    }

    @inputText(
      mf("meta.name"),
      '_label -> messages("Name")
    )

    @inputText(
      mf("meta.town"),
      '_label -> messages("Town")
    )

    @textarea(
      mf("meta.address"),
      '_label -> messages("Address")
    )

    @inputText(
      mf("meta.siteUrl"),
      '_label -> messages("Site")
    )

    @if(nodeInfo.isProducer || nodeInfo.isReceiver) {
      @textarea(
        mf("meta.info"),
        '_label -> messages("Info.about.prods.and.svcs")
      )
    }

    <hr class="delimiter __light"/>

    @if(nodeInfo.isReceiver) {
      @inputText(
        mf("meta.humanTrafficAvg"),
        '_label -> messages("Daily.people.traffic")
      )

      @textarea(
        mf("meta.audienceDescr"),
        '_label -> messages("Audience.descr")
      )
      <hr class="delimiter __light"/>

      <div class="prop" >
        <p class="prop_name __block">@messages("Welcome.screen"):</p>
        @_welcomeAdFormTpl(adnId, welcomeAdOpt, mf)
      </div>

      <hr class="delimiter __light"/>

      <div class="prop" id="profileGallery">
        <p class="prop_name __block">@messages("Node.photos"):</p>

        @mf("gallery").errors.map { error =>
          <p class="block __margin-M red">@messages("Error"): @messages(error.message, error.args: _*)</p>
        }

        <div class="image __size-M f-left js-image-upload" >
          @stuff._fileUploadTpl(
            call          = routes.MarketLkAdnEdit.handleGallweryImg(),
            fieldName     = "gallery",
            multiple      = true,
            previewRoot   = "#profileGallery",
            previewClass  = "__size-M f-left",
            editBtnClass  = "image_edit-btn js-crop-image-btn",
            whOpt         = Some(MImgInfoMeta(width = 790, height = 250))
          )
          <a class="image_add-btn js-file-upload-btn" title="@messages("Upload.photo")">
            <span>@Html( messages("Add.photo", "<br/>") )</span>
          </a>
        </div>

        @* Рендерим существующие значения. gf - поле, gfi - индекс картинки (1, 2, 3), gfn - имя поля в индексе ("gallery[0]") *@
        @defining( mf("gallery") ) { gf =>
          @gf.indexes.map { gfi =>
            @defining( s"gallery[$gfi]" ) { gfn =>
              @mf(gfn).value.map { imgId =>
                <div class="image __size-M f-left js-preview">
                  <input class="js-image-key" type="hidden" name="@gfn" value="@imgId"/>
                  <img class="image_src" src="@DynImgUtil.thumb256Call(imgId, fillArea = false)" />
                  <a class="image_edit-btn js-crop-image-btn" title="@messages("Edit")">
                    <span></span>
                  </a>
                </div>
              }
            }
          }
        }
      </div>

      <hr class="delimiter __light"/>

    }

    <table class="prop">
      <tr>
        <td class="prop_name td">
          @messages("Bg.color.of.sc.hint")
        </td>
        <td class="td __color-title">
	  <span class="dark-gray ft-S">@Html( messages("Main.color", "<br/>") )</span>
        </td>
        <td class="td __padding-S">
          @defining( mf("meta.color").value.map(_.trim).filter(!_.isEmpty).getOrElse("FFFFFF") ) { colorValue =>
            <div class="color __select js-custom-color" data-for=".__logo" style="background-color: #@colorValue;">
              <input type="hidden" name="meta.color" value="@colorValue"/>
            </div>
          }
        </td>
        <td class="td __padding-S">
          <div class="delimiter __light __vertical @VLines.JSVL_CLASS"></div>
        </td>
        <td class="td __padding-S prop_name">
          @messages("Fg.color.of.sc.hint")
          <a class="link js-btn" href="#editHelp">?</a>
        </td>
        <td class="td __color-title">
          <span class="dark-gray ft-S">@Html( messages("Content.color", "<br/>") )</span>
        </td>
        <td class="td __padding-S dark-gray">
          @defining( mf("meta.fgColor").value.map(_.trim).filter(!_.isEmpty).getOrElse("FFFFFF") ) { colorValue =>
            <div class="color __select js-custom-color" style="background-color: #@colorValue;">
              <input id="meta_color" type="hidden" name="meta.fgColor" value="@colorValue"/>
            </div>
          }
        </td>
      </tr>
    </table>

  </div>

}
