@(mnodes: Seq[MNode], withDelims: Boolean = true)(implicit ctx: Context)

@* Инлайновый список узлов. *@

@import ctx._
@import sys1.stuff.ntable._
@import msys._

@if(mnodes.nonEmpty) {
@defining("M") { sz =>

  @_ntable() {
    @* _ntable.headRow *@

    @_th(sz) {
      @messages("Name")
    }
    @_th(sz) {
      @messages("Type")
    }
    @_th(sz) {
      @messages("Town")
    }

  } {
    @* _ntable.rows *@

    @mnodes.groupBy(AdnShownTypes.node2val).map { case (ast, mnodes1) =>

      @* Строка явных разделителей групп узлов. Она наверху, чтобы озаглавить нижеследующую группу узлов. Вниз переносить её не надо. *@
      @if(withDelims) {
        @_tr() {
          @_td(sz) {
            -------------
          }
          @_td(sz) {
            <a class="blue-link" href="@routes.SysMarket.adnNodesList( MSysNodeListArgs(Some(MNodeTypes.AdnNode), Some(ast)) )">
              @messages( ast.singular )
            </a>
          }
          @_td(sz) {
            -------------
          }
        }
      }

      @mnodes1.sortBy(_.meta.basic.name).map { mnode =>
        @_tr() {
          @_td(sz) {
            @if(mnode.common.isEnabled) {<strong>} else {<strike title="Этот узел отключён (isEnabled = false).">}
              <a class="blue-link" href="@routes.SysMarket.showAdnNode(mnode.id.get)">
                @mnode.meta.basic.name
              </a>
            @if(mnode.common.isEnabled) {</strong>} else {</strike>}
            @mnode.extras.adn.map { adn =>
              @if(adn.testNode) {<span title="Тестовый узел. Он скрыт от нетестовых узлов.">⚗</span>}
              @if(adn.isReceiver) {<span title="Приёмник рекламных карточек (receiver).">®</span>}
              @if(adn.isUser) {<span title="Этот узел создан пользователем, НЕ администратором.">&#x2692;</span>}
            }
          }
          @_td(sz) {
            @messages( ast.singular )
          }
          @_td(sz) {
            @mnode.meta.address.town
          }

        } @* _tr() *@

      } @* mnodesGroup.map *@
    }   @* mnodes.groupBy.map *@

  } @* _ntable.rows *@

} @* defining sz = M *@
} @* if mnodes.nonEmpty *@
