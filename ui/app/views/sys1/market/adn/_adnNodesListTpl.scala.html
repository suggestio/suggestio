@(adnNodes: Seq[MAdnNode], companies: Option[Map[String, MCompany]] = None,
  withDelims: Boolean = true)(implicit ctx: Context)

@* Инлайновый список узлов. *@
@import ctx._
@import sys1.stuff.ntable._

@if(adnNodes.nonEmpty) {
@defining("M") { sz =>

  @_ntable() {
    @* _ntable.headRow *@

    @_th(sz) {
      @messages("Name")
    }
    @_th(sz) {
      @messages("Type")
    }
    @_th(sz) {
      @messages("Town")
    }
    @if(companies.isDefined) {
      @_th(sz) {
        @messages("Company")
      }
    }

  } {
    @* _ntable.rows *@

    @adnNodes.groupBy(_.adn.shownTypeId).map { case (shownTypeId, adnNodes1) =>

      @* Строка явных разделителей групп узлов. Она наверху, чтобы озаглавить нижеследующую группу узлов. Вниз переносить её не надо. *@
      @if(withDelims) {
        @_tr() {
          @_td(sz) {
            -------------
          }
          @_td(sz) {
            <a class="blue-link" href="@routes.SysMarket.adnNodesList(Some(shownTypeId))">
              @messages("amts.of.type." + shownTypeId)
            </a>
          }
          @_td(sz) {
            -------------
          }
          @if(companies.isDefined) {
            @_td(sz) {
              -------------
            }
          }
        }
      }

      @adnNodes1.sortBy(_.meta.name).map { adnNode =>
        @_tr() {
          <td>
            <div class="siom-cell-cnt __size-M">
              @if(adnNode.adn.isEnabled) {<strong>} else {<strike title="Этот узел отключён (isEnabled = false).">}
                <a class="blue-link" href="@routes.SysMarket.showAdnNode(adnNode.id.get)">
                  @adnNode.meta.name
                </a>
              @if(adnNode.adn.isEnabled) {</strong>} else {</strike>}
              @if(adnNode.adn.testNode) {<span title="Тестовый узел. Он скрыт от нетестовых узлов.">⚗</span>}
              @if(adnNode.adn.isReceiver) {<span title="Приёмник рекламных карточек (receiver).">®</span>}
              @if(adnNode.adn.hasWifiSink) {<span title="Включена Wi-Fi выдача.">wifi</span>}
              @if(adnNode.adn.hasGeoSink) {<span title="Включена geo-выдача.">geo</span>}
              @if(adnNode.adn.isUser) {<span title="Этот узел создан пользователем, НЕ администратором.">&#x2692;</span>}
            </div>
            <div class="border-line"></div>
          </td>
          <td>
            <div class="siom-cell-cnt __size-M">
              @messages("amt.of.type." + adnNode.adn.shownTypeId)
            </div>
            <div class="border-line"></div>
          </td>
          <td>
            <div class="siom-cell-cnt __size-M">&nbsp;
              @adnNode.meta.town
            </div>
            <div class="border-line"></div>
          </td>
          @companies.map { _companies =>
            <td>
              <div class="siom-cell-cnt __size-M">
                @adnNode.companyId.flatMap(_companies.get).map { mc =>
                  <a class="blue-link" href="@routes.SysMarket.companyShow(mc.id.get)">@mc.meta.name</a>
                }
              </div>
              <div class="border-line"></div>
            </td>
          }

        } @* _tr() *@

      } @* adnNodesGroup.map *@
    }   @* adnNodes.groupBy.map *@

  } @* _ntable.rows *@

} @* defining sz = M *@
} @* if nonEmpty *@
