@(adnNode: MAdnNode, slaves: Seq[MAdnNode], personNames: Map[String, String] = Map.empty)(implicit ctx: Context)

@* Страница, отображающая информацию по торговому центру. *@

@import ctx._
@import helper._
@import util.qsb._
@import lk.lkBlock
@import sys1.person.parts._personLinkTpl
@import models.mdr._


@* Подшаблон генерации квадратной кнопки. *@
@btn1(href: String, paddingPx: Int)(btnText: Html) = {
  <div class="i __btn">
    <a class="siom-link-btn __color-5 __size-XL __ft-XM" href="@href" style="padding: @{paddingPx}px 0;">
      @btnText
    </a>
  </div>
}
@btn(href: Call, paddingPx: Int)(btnText: Html) = {
  @btn1(href.url, paddingPx)(btnText)
}

@tableRow(title: String)(value: Html) = {

  <tr>
    <td class="siom-cell __size-S __inner-S">
      @title
    </td>
    <td class="siom-cell __inner-S">
      @value
    </td>
  </tr>

}

@* Обязательно нужен пустой токен пути заголовка, иначе будет дублирование названия узла в пути заголовка. *@
@hPathAfter = { }

@adnBase(
  title = adnNode.meta.name,
  hPathAfter = Some(hPathAfter),
  nodeOpt = Some(adnNode)
) {

  <div class="sys_t">
    @messages("amt.of.type." + adnNode.adn.shownTypeId):
    @adnNode.meta.nameShort

    <a class="edit-btn __color-1 __ft-XS" href="@routes.SysMarket.editAdnNode(adnNode.id.get)">@messages("Edit")</a>
  </div>

  <div class="i-list">

    @btn(routes.MarketLkAdn.showNodeAds(adnNode.id.get), 28) { ЛИЧНЫЙ<br/>КАБИНЕТ<br/>УЗЛА }

    @btn1(ctx.SC_URL_PREFIX + routes.MarketShowcase.demoWebSite(adnNode.id.get).url, 52) { ВЫДАЧА }

    @btn(routes.SysMarketBilling.billingFor(adnNode.id.get), 52) { БИЛЛИНГ }

    @btn(routes.SysAdnGeo.forNode(adnNode.id.get), 52) { GEO }
  </div>


  @lkBlock("Метаданные") {
    @_nodeMetaTpl(adnNode.meta)
  }

  @if(slaves.nonEmpty) {
    @lkBlock("Подчинённые узлы(" +slaves.size +")") {
      @_adnNodesListTpl(slaves, withDelims = false)
      <div class="btn-w __size-M">
        <a class="siom-ac-btn __color-1 __size-M __ft-XM f-left" href="@routes.SysMarket.createAdnNode(adnNode.id)">+Добавить подузел</a>
      </div>
    }
  }

  @lkBlock("Пользователи") {
    @if(adnNode.personIds.isEmpty) {
      <p class="color-light-strong">Нет пользователей, управляющих этим узлом.</p>
    } else {
      @adnNode.personIds.iterator.map { personId =>
        @_personLinkTpl(personId, personNames)
      }
    }
  }

  @lkBlock("Участие в рекламной сети") {

    <table class="color-light-strong">
      @tableRow("Права:") {

        <strong class="color-strong">
          @adnNode.adn.rights.map(_.longName).mkString(", ")
        </strong>

      }

      @* TODO Надо бы отображать как-то showLevelsInfo. *@
      @tableRow("isEnabled:") {
        <strong class="color-strong">@adnNode.adn.isEnabled</strong>
      }

      @adnNode.adn.disableReason.map { dr =>
        @tableRow("disableReason:") {
          <strong class="color-strong">@dr</strong>
        }

      }
    </table>

  }


  @lkBlock("Управление") {

    @btn(
      href = routes.SysMarket.showAdnNodeAds(new AdSearchImpl { override def producerIds = adnNode.id.toList }),
      paddingPx = 28
    ) { Собственные<br/>рекламные<br/>карточки }

    @btn(
      href = routes.SysMarket.showAdnNodeAds(new AdSearchImpl { override def receiverIds = adnNode.id.toList }),
      paddingPx  = 28
    ) { Рекламные<br/>карточки<br/>в выдаче }

    @btn(
      href = routes.SysMarket.nodeOwnerInviteForm(adnNode.id.get),
      paddingPx = 28
    ) { Инвайты на<br/>управление<br/>узлом }

    @btn(
      href = routes.SysMarket.installDfltMads(adnNode.id.get),
      paddingPx = 28
    ) { Установка<br/>дефолтовых<br/>карточек }

  }


  @lkBlock("Модерация бесплатного размещения") {

    <a class="siom-ac-btn __color-2 __size-M __ft-XM __list f-left" href="@routes.SysMdr.freeAdvs(MdrSearchArgs(producerId = adnNode.id))">Очередь на модерацию</a>
    <a class="siom-ac-btn __color-1 __size-M __ft-XM __list f-left" href="@routes.SysMdr.freeAdvs(MdrSearchArgs(freeAdvIsAllowed = Some(true), producerId = adnNode.id))">Одобренные</a>
    <a class="siom-ac-btn __color-4 __size-M __ft-XM __list f-left" href="@routes.SysMdr.freeAdvs(MdrSearchArgs(freeAdvIsAllowed = Some(false), producerId = adnNode.id))">Отклонённые</a>
  }


  @lkBlock("Отладка") {

    <p class="color-light-strong">
      Отобразить email-письмо инвайта:
      <a class="blue-link" href="@routes.SysMarket.showEmailInviteMsg(adnNode.id.get)">HTML</a>
    </p>

  }

}

