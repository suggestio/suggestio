@(mads: Seq[MAd], nodeOpt: Option[MAdnNode], adFreqs: AdFreqs_t, rcvrsMap: Map[String, Seq[MAdnNode]], a: AdSearch, ad2advMap: Map[String, Traversable[MAdvI]])(implicit ctx: Context)

@* Список реклам и сервисных функций. *@

@import util.TplDataFormatUtil._
@import models.stat.AdStatActionsTpl._
@import ctx._
@import helper._
@import views.html.lk.ad._
@import datetime._


@hPathAfter1 = {
  / Реклама
}

@headAfter = {
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/lk/ads-list.css")'/>
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/showcase.css")'/>
}

@adnBase(
  title = "Рекламные карточки",
  headAfter = Some(headAfter),
  hPathAfter = Some(hPathAfter1),
  nodeOpt = nodeOpt
) {

  <div class="ovh">
    @_adsListTpl(mads, coverDisableReason = false, startIndex = 0, itemsInLine = 4) { mad =>
      <a class="siom-ac-btn __color-2 __size-XL __ft-XM __list-vertical" href="@routes.MarketAd.editAd(mad.id.get)">Редактор карточки</a>
      <a class="siom-link-btn __color-3 __size-XL __ft-XM __list-vertical" href="@routes.MarketLkAdn.showAdnNode(mad.producerId)">ЛК создателя карточки</a>
      <p>Отобразить email-сообщение о деактивации:
        <a class="blue-link" href="@routes.SysMarket.showShopEmailAdDisableMsg(mad.id.get)">HTML</a>
      </p>

      @nodeOpt.map { adnNode =>
        @* Вывод статистики для узла-продьюсера. *@
        <p>Stat:
          @adFreqs.get(mad.id.get).map { freqs =>
            За последние @MAdStat.TTL_DAYS_DFLT дней:
            @freqs.map { case (action, freq) =>
              @action: @freq
            }
          }
        </p>
      }

      @mad.id.flatMap(rcvrsMap.get).map { rcvrs =>
        <br/>
        @rcvrs.map { rcvr =>
          @form( routes.SysMarket.removeAdRcvr(adId = mad.id.get, rcvrId = rcvr.id, r = ctx.r) ) {
            <a class="siom-ac-btn __color-3 __size-XL __ft-XM __list-vertical js-submit-btn">
              Убрать из выдачи<br/>
              на узле<br/>
              <strong>&laquo;@rcvr.meta.name / @rcvr.meta.town &raquo;</strong>
            </a>
          }
        }
      }

      @if( nodeOpt.flatMap(_.id) exists { adnId => mad.receivers.get(adnId).exists(_.sls.nonEmpty)} ) {
        <p>Саморазмещение</p>
      }

      @mad.id.flatMap(ad2advMap.get).map { advs =>
        @advs.map { adv =>
          <p>
            @Messages("adv.mode." + adv.mode)
            @adv.maybeOk.map { advOk =>
              @if(advOk.isAuto) {авто}
            }размещение
            c [@_prettyDate(adv.dateStart, withSpan = true)]
            по [@_prettyDate(adv.dateEnd, withSpan = true)]
            <a class="blue-link" href="@routes.SysMarket.showAdnNode(adv.prodAdnId)">узел</a>
            =&gt;
            <a class="blue-link" href="@routes.SysMarket.showAdnNode(adv.rcvrAdnId)">узел</a>
            @adv.maybeOk.map { advOk =>
              @if(advOk.isPartner) {по-партнёрски}
            }
            за @formatPrice(adv.amount, adv.currency)
          </p>
        }
      }
      <a href="@routes.SysMarket.analyzeAdRcvrs(mad.id.get)">Карта ресиверов...</a>
      <a href="@routes.SysMarket.showAd(mad.id.get)">sys-страница карточки</a>
      <br/><br/>
    }
  </div>

  <br/><br/>


  @* Рендерим переключение страниц. *@
  Страницы:

  @if( a.offsetOpt.exists(_ > 0) ) {
    <a class="blue-link" href="@routes.SysMarket.showAdnNodeAds(a.withoutOffset)">Первая</a>
  }

  @if(a.offsetOpt.isDefined) {
    <a class="blue-link" href="@routes.SysMarket.showAdnNodeAds( a.minusOffset() )">Предыдущая</a>
  }

  <strong class="color-strong">@(a.offset / a.maxResults)</strong>

  <a class="blue-link" href="@routes.SysMarket.showAdnNodeAds( a.plusOffset() )">Следующая</a>

}
