@(rf: EmailPwRegReqForm_t, captchaShown: Boolean)(implicit ctx: Context)

@import helper._
@import util.captcha.CaptchaUtil.{CAPTCHA_ID_FN, CAPTCHA_TYPED_FN}
@import io.suggest.util.StringUtil.randomId
@import ctx._
@import util.FC.authFc
@import io.suggest.err.ErrorConstants._
@import io.suggest.captcha.CaptchaConstants._


@defining( CSRF(routes.Ident.emailRegSubmit()) ) { submitCall =>
@form(submitCall, 'id -> "indexRegForm") {

  @rf.globalError.map { ge =>
    <p class="@ERROR_MSG_CLASS">@messages("Error"): @messages(ge.message)</p>
  }

  @inputText(
    rf("email"),
    '_label       -> "e-mail",
    'type         -> "email",
    'placeholder  -> messages("Your.email.addr")
  )

  <div @if(!captchaShown){style="display: none;" id="@HIDDEN_CAPTCHA_DIV_ID"}>
    <div class="auth-page_input">
      @* Капча, которая появляется, когда есть активность, связанная с полем регистрации или долбления на кнопку "отправить". *@
      @defining( rf(CAPTCHA_ID_FN).value.filter(!_.isEmpty).getOrElse(randomId(6, ctx.PRNG)) ) { captchaId =>
        <input id="captchaId" type="hidden" name="@CAPTCHA_ID_FN" value="@captchaId"/>
        <img class="captcha_img" id="captchaImageRegistrationForm" alt=""
             @defining( routes.Captcha.getDigitalCaptcha(captchaId, submitCall.url) ) { call =>
               @if(!captchaShown) {@ATTR_HIDDEN_SRC="@call"}
               src="@if(captchaShown){@call}"
             }
             />
        <a class="captcha_reload-btn __small"
           id="@CAPTCHA_RELOAD_BTN_ID"
           @ATTR_RELOAD_FOR="#captchaImageRegistrationForm"
           href="@ctx.request.uri"></a>
      }
    </div>

    @defining( messages("Input.text.from.picture") ) { msg =>
      @inputText(
        rf(CAPTCHA_TYPED_FN),
        '_label       -> msg,
        'type         -> "tel",
        'placeholder  -> msg,
        'id	      -> CAPTCHA_TYPED_INPUT_ID
      )
    }

  </div>

  <p class="auth-page_descr">
    @messages("Mailbox.ll.be.mailed.with.reg.confirm.msg")
  </p>

  <p class="auth-page_descr">
    @Html(messages(
      "Getting.started.with.sio.you.agreed.with.policy",
      s"""<a class="auth-page_link" href="${routes.Static.privacyPolicy()}">""",
      "</a>"
    ))
  </p>

  <div class="btn-w __size-M">
    <input class="btn __size-M1 __minor" type="submit" value="@messages("Send")" />
  </div>

}
} @* defining submitCall *@
