@(lastPays: Seq[MBillTxn], contracts: Map[Int, MBillContract], adns: Map[String, MAdnNode])(implicit ctx: util.Context)

@* Страница биллинга вне сущностей рекламной сети.
   Здесь есть ссылка на транзакцию и список последний транзакций. *@
@import datetime._

@billingBase("Весь биллинг") {

  <div class="sys_t">
    Общий биллинг
  </div>

  <p class="paragraph __size-M">
    <a class="siom-ac-btn __color-1 __size-M __ft-XM" href="@routes.SysMarketBilling.incomingPaymentForm">
      Провести платёж...
    </a>
  </p>

  @market.lk.lkBlock("Последние платежи") {

    @if(lastPays.isEmpty) {
      <p class="color-light-strong">
        Пока не было ни одного платежа.
      </p>
    } else {
      <table class="siom-table __size-XL color-strong">
        <tr>
          <th class="siom-cell-head __text-align-1">
            <div class="siom-cell-cnt __size-M">
              <strong>Когда</strong>
            </div>
            <div class="border-line"></div>
          </th>
          <th class="siom-cell-head __text-align-1">
            <div class="siom-cell-cnt __size-M">
              <strong>Сумма</strong>
            </div>
            <div class="border-line"></div>
          </th>
          <th class="siom-cell-head __text-align-1">
            <div class="siom-cell-cnt __size-M">
              <strong>Договор</strong>
            </div>
            <div class="border-line"></div>
          </th>
          <th class="siom-cell-head __text-align-1">
            <div class="siom-cell-cnt __size-M">
              <strong>Плательщик</strong>
            </div>
            <div class="border-line"></div>
          </th>
        </tr>
        @lastPays.map { txn =>
          <tr>
            <td>
              <div class="siom-cell-cnt __size-M">
                @_prettyDate(txn.dateProcessed, withSpan = true)
              </div>
              <div class="border-line"></div>
            </td>
            <td>
              <div class="siom-cell-cnt __size-M">
                @txn.amount @txn.currencyCodeOpt
              </div>
              <div class="border-line"></div>
            </td>
            @defining(contracts.get(txn.contractId)) { mbcOpt =>
              <td>
                <div class="siom-cell-cnt __size-M">
                  @mbcOpt.map { mbc =>
                    <span title="Договор от @mbc.printContractDate">@mbc.legalContractId</span>
                  }
                </div>
                <div class="border-line"></div>
              </td>
              <td>
                <div class="siom-cell-cnt __size-M">
                  @mbcOpt.map(_.adnId).flatMap(adns.get).map { adnNode =>
                    <a class="blue-link" href="@routes.SysMarket.showAdnNode(adnNode.id.get)">@adnNode.meta.name / @adnNode.meta.town</a>
                  }
                </div>
                <div class="border-line"></div>
              </td>
            }
          </tr>
        }
      </table>
    }

  }

}
