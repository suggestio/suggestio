@(adnNode: MAdnNode, balanceOpt: Option[MBillBalance], contracts: List[MBillContract], txns: Seq[MBillTxn])(implicit ctx: util.Context)

@* Страница с информацией по биллингу указанного узла рекламной сети. *@
@import datetime._
@import ctx._

@billingBase(adnNode.meta.name, Some(adnNode)) {

  @balanceOpt.map { balance =>
    <p>Текущий баланс: @balance.amount @balance.currencyCode</p>
  }

  <h2>Транзакции</h2>
  @if(!txns.isEmpty) {
    <table>
      <tr>
        <th>id</th>
        <th>Оплачен</th>
        <th>Обработан</th>
        <th>Сумма</th>
        <th>Комментарий</th>
      </tr>
      @txns.map { txn =>
        <tr>
          <td>@txn.txnUid</td>
          <td>@_prettyDate(txn.datePaid, withSpan = true)</td>
          <td>@_prettyDate(txn.dateProcessed, withSpan = true)</td>
          <td>@txn.amount @txn.currencyCode</td>
          <td>@txn.paymentComment</td>
        </tr>
      }
    </table>
  } else {
    Нет транзакций.
  }
  <p><a href="@routes.SysMarketBilling.incomingPaymentForm">Провести платёж...</a></p>


  <h2>Контракты</h2>
  @if(contracts.isEmpty) {
    Пока нет заключенных договоров.
  } else {
    @contracts.map { contract =>
      <h2>Договор № @contract.legalContractId</h2>
      <p><a href="@routes.SysMarketBilling.editContractForm(contract.id.get)">Изменить...</a></p>
      <p>Дата заключения договора:
          @contract.printContractDate
          (@_prettyDate(contract.contractDate, withSpan = true))
      </p>
      <p>Добавлен в sio: @_prettyDate(contract.dateCreated, withSpan = true)</p>
      @if(!contract.isActive) {
        <p><b>Не активен</b>.</p>
      }
      @contract.hiddenInfo.map { hiddenInfo =>
        <p>Служебная информация:</p>
        <pre>@hiddenInfo</pre>
      }
    }
  }
  <a href="@routes.SysMarketBilling.createContractForm(adnNode.id.get)">Добавить договор...</a>


  <h2 title="Тарифы используются для списания денег со счета. Любой узел сети может иметь любое число действующих тарифов.">Тарификация</h2>
  @if(adnNode.tariffs.isEmpty) {
    Нет тарифов.
  } else {
    <table>
      <tr>
        <th>#</th>
        <th>Активен?</th>
        <th>Имя</th>
        <th>Тип</th>
        <th>Суть</th>
        <th>Старт</th>
        <th>Действия</th>
      </tr>
      @adnNode.tariffs.map { tariff =>
        <tr>
          <td>@tariff.id</td>
          <td>@tariff.isEnabled</td>
          <td>@tariff.name</td>
          <td>@Messages("tariff.type." + tariff.tType)</td>
          <td title="@tariff.tBody">@tariff.tBody.describe</td>
          <td>@datetime._prettyDate(tariff.dateFirst, withSpan = true)</td>
          <td>
              <a href="@routes.SysMarketBillingTariff.editTariffForm(adnNode.id.get, tariff.id)">@Messages("Edit")</a>
          </td>
        </tr>
      }
    </table>
  }
  <a href="@routes.SysMarketBillingTariff.addTariffForm(adnNode.id.get)">Добавить тариф...</a>
}
