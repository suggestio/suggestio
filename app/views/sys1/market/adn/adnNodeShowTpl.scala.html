@(adnNode: MAdnNode, slaves:Seq[MAdnNode], company: Option[MCompany] = None)(implicit ctx: util.Context)

@* Страница, отображающая информацию по торговому центру. *@
@import ctx._
@import helper._
@import controllers.adn.AdnShowTypes._
@import util.qsb._

@hPathAfter = {
  @* Исходного заголовка достаточно для рендера. *@
}

@adnBase(adnNode.meta.name, Some(hPathAfter), Some(adnNode)) {

  <h2>@Messages("amt.of.type." + adnNode.adn.memberType)</h2>
  <a href="@routes.SysMarket.editAdnNode(adnNode.id.get)">@Messages("Edit")</a>

  <p><a href="@routes.MarketLkAdn.showAdnNode(adnNode.id.get)"><b>-&gt; Личный кабинет узла</b></a></p>

  @adnNode.adn.memberType.nodeAdmSiteCall(adnNode).map { siteCall =>
    <p><a href="@siteCall"><b>-&gt; demoWebSite</b></a>
      (<a href="http://10.0.0.101:9001@siteCall" target="_blank">osm01-vpn</a>)
    </p>
  }

  <a href="@routes.SysMarketBilling.billingFor(adnNode.id.get)">Billing</a>


  @company.map { mc =>
    <p>@Messages("Company")-@Messages("Owner"): <a href="@routes.SysMarket.companyShow(mc.id.get)">@mc.meta.name</a></p>
  }


  <h3>Метаданные</h3>
  <div>
    @_nodeMetaTpl(adnNode.meta)
  </div>


  <br/>
  <h3>Подчинённые узлы (@slaves.size)</h3>
  <a class="add" href="@routes.SysMarket.createAdnNode(adnNode.id)">Добавить подузел...</a><br/>
  @if(slaves.isEmpty) {
    <p>Нет подчинённых узлов.</p>
  } else {
    <br/>
    @_adnNodesListTpl(slaves, withDelims = false)
  }


  <br/>
  <h3>Участие в рекламной сети</h3>
  Права: @adnNode.adn.rights.map(_.longName).mkString(", ")<br/>
  @if(!adnNode.adn.producerIds.isEmpty) {
    producerIds = @adnNode.adn.producerIds.toSeq.zipWithIndex.map { case (producerId, i) =>
      <a href="@routes.SysMarket.showAdnNode(producerId)">@i</a>
    }
    <br/>
  }
  @* TODO Надо бы отображать как-то showLevelsInfo. *@
  isEnabled = @adnNode.adn.isEnabled<br/>
  @adnNode.adn.disableReason.map { dr =>
    disableReason = @dr<br/>
  }


  <br/>
  <h3>Управление</h3>
  Список рекламных карточек узла:
    <a href="@routes.SysMarket.showAdnNodeAds(AdSearch(producerIds = adnNode.id.toList))">собственных</a>,
    <a href="@routes.SysMarket.showAdnNodeAds(AdSearch(receiverIds = adnNode.id.toList))">в выдаче</a>.
  <br/>

  @* Категории в рамках узла возможны, но отключены до лучших времён. *@
  @*<a href="@routes.MarketCategory.showCatsFor(adnNode.id.get)">Категории</a><br/>*@

  <a href="@routes.SysMarket.nodeOwnerInviteForm(adnNode.id.get)">Инвайты на управление узлом</a><br/>

  @* Функционал товаров и прайс-листов пока скрыт: кравлер не готов, товары не нужны. *@
  @*<a href="@routes.SysMarket.splAddForm(mshop.id.get)">Добавить источник прайс-листа.</a>
    <a href="@routes.MarketOffer.showShopPromoOffers(mshop.id.get)">ЛК: Товары магазина</a> *@


  <br/>
  <p>
      Модерация бесплатного размещения:
      <a href="@routes.SysMdr.freeAdvs(MdrSearchArgs(producerId = adnNode.id))">Очередь на модерацию</a> /
      <a href="@routes.SysMdr.freeAdvs(MdrSearchArgs(freeAdvIsAllowed = Some(true), producerId = adnNode.id))">Одобренные</a> /
      <a href="@routes.SysMdr.freeAdvs(MdrSearchArgs(freeAdvIsAllowed = Some(false), producerId = adnNode.id))">Отклонённые</a>
  </p>


  <br/>
  <h3>Отладка</h3>
  Отобразить email-письмо инвайта:
    <a href="@routes.SysMarket.showEmailInviteMsg(adnNode.id.get, isHtml=true)">HTML</a>,
    <a href="@routes.SysMarket.showEmailInviteMsg(adnNode.id.get, isHtml=false)">TXT</a>
    <br/>

}

