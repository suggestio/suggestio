@(af: Form[_], call: Call, companies: Seq[MCompany], btnText: String)(implicit ctx: util.Context)

@* Форма для создания/редактирования узла рекламной сети.
   При верстке шаблона следует помнить, что mcompany.id может быть None. *@
@import helper._
@import ctx._
@import util.FC.tdFc


@form(call) {
  @* ADN *@
  <table class="input-w __size-L">
    <td class="input-w_left">
      <label class="input-w_prop-name">
        Тип узла ADN
      </label>
    </td>
    <td>
      @defining(af("adn.memberType")) { mtField =>
        <select name="@mtField.name">
          <option disabled>Тип узла</option>
          @AdNetMemberTypes.values.map { anmt =>
            <option value="@anmt.name" @if(mtField.value.exists(_ == anmt.name)) {selected}>@Messages("amt.of.type." + anmt.name)</option>
          }
        </select>
      }
    </td>
  </table>

  <table class="input-w __size-L">
    <td class="input-w_left">
      <label class="input-w_prop-name">
        Отображаемый тип узла
      </label>
    </td>
    <td>
      @defining( af("adn.shownTypeIdOpt") ) { stiField =>
        <select name="@stiField.name">
          <option disabled>Тип узла</option>
          @AdnShownTypes.values.map { ast =>
            <option value="@ast" @if(stiField.value.exists(_ == ast.toString)) {selected}>@Messages("amt.of.type." + ast)</option>
          }
        </select>
      }
    </td>
  </table>

  <table class="input-w __size-L">
    @checkbox(af("adn.isEnabled"), '_label -> "Включён?", '_class -> "sys-checkbox")
  </table>


  @* Компания, к которой принадлежит узел. В продакшене это задаётся неявно. *@
  <table class="input-w __size-L">
    <td class="input-w_left">
      <label class="input-w_prop-name">

      </label>
    </td>
    <td>
      @defining(af("companyId")) { ciField =>
        @defining(ciField.value.orElse(request.getQueryString("company_id")).getOrElse("")) { currCompanyId =>
          <select name="@ciField.name">
            <option disabled>@Messages("Company")-@Messages("Owner")</option>
            @companies.map { mcompany =>
              <option value="@mcompany.id"@if(mcompany.id.exists(_ == currCompanyId)) {selected}>@mcompany.meta.name</option>
            }
          </select>
        }
      }
    </td>
  </table>


  @* meta *@
  <table class="input-w __size-L">
    @inputText(af("meta.name"),    '_label -> "Название")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.nameShort"),    '_label -> "Короткое название")
  </table>
  <table class="input-w __size-L">
    @textarea(af("meta.descr"),    '_label -> "Описание объекта")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.town"),    '_label -> "Город")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.address"), 'placeholder -> "пр.Ленина, д.1",  '_label -> "Адрес в городе")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.phone"),   'placeholder -> "+78121234567",    '_label -> "Номер телефона")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.floor"),   'placeholder -> 1,                 '_label -> "Этаж")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.section"), 'placeholder -> 101,               '_label -> "Номер секции")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.siteUrl"), 'placeholder -> "http://",         '_label -> "Адрес сайта в интернете")
  </table>
  <table class="input-w __size-L">
    @inputText(af("meta.color"),   'placeholder -> "cceeff",          '_label -> "Цвет")
  </table>
  <table class="input-w __size-L">
    @inputText(af("personIds"),    '_label -> "id пользователей админов узла через запятую")
  </table>

  @* conf *@
  <table class="input-w __size-L">
    @inputText(af("conf.withBlocks"), 'placeholder -> "1, 2, 3",      '_label -> "Доп.id блоков")
  </table>


  @AdnRights.values.map { adnRight =>
    <table class="input-w __size-L">
      @checkbox(af(s"adn.rights.${adnRight.longName}"), '_label -> adnRight.longName, '_class -> "sys-checkbox")
    </table>
  }

  <table class="input-w __size-L">
    @inputText(af("adn.sls.in"),  '_label -> "Входящие уровни отображения и лимиты")
  </table>
  <table class="input-w __size-L">
    @inputText(af("adn.sls.out"), '_label -> "Исходящие уровни отображения и лимиты")
  </table>

  <table class="input-w __size-L">
    @checkbox(af("adn.testNode"), '_label -> "Тестовый узел?", '_class -> "sys-checkbox")
  </table>

  <p>Формат: 'd = 1, m = 20, h = 5'.<br/>
  @AdShowLevels.values.map { sl =>
    @sl.name -- @Messages("lk.sl." + sl.name),
  }</p>

  <table class="input-w __size-L">
    @inputText(af("adn.supId"), '_label -> "id узла-супервизора, если есть.")
  </table>

  <table class="input-w __size-L">
    @inputText(
      af("adn.advDelegate"),
      '_label -> "id узла-делегата рекламного размещения, если есть.",
      'title  -> "Входящие запросы рекламного размещения будут отправляться к указанному узлу, а не к текущему."
    )
  </table>

  <table>
    @inputText(
      af("conf.showcaseVoidFiller"),
      '_label -> "Заполнение пустот выдачи",
      'title -> "Идентификатор или текст для заполнения пустот в выдаче."
    )
  </table>

  <table class="input-w __size-L">
    @AdnSinks.ordered.map { sink =>
      @checkbox(
        af("adn.sink." + sink.longName),
        '_label -> Messages("adn.sink." + sink.longName)
      )
    }
  </table>

  <table class="input-w __size-L">
    @checkbox(
      af("adn.conf.showcaseVoidFiller"),
      'label -> "Отображать в списке узлов выдачи?")
    )
  </table>

  <div class="btn-w __size-M">
    <a class="siom-ac-btn __color-1 __size-M __ft-XM f-right js-submit-btn">@btnText</a>
  </div>

}
