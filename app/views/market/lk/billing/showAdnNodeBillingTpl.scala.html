@(adnNode: MAdnNode, mmpDailyTariffs: Seq[MBillMmpDaily], mbc: MBillContract, otherRcvrs: Seq[MAdnNode])(implicit ctx: util.Context)

@* Страница с информацией по биллингу для узла рекламной сети. *@
@import ctx._
@import util.TplDataFormatUtil._
@import datetime._

@market.lk.lkBase("Биллинг | " + adnNode.meta.name, adnIdOpt = adnNode.id) {

<div class="title-wrap" xmlns="http://www.w3.org/1999/html">
    <div class="center">
      <a class="back-but" href="@routes.MarketLkAdn.showAdnNode(adnNode.id.get)">&nbsp;</a>
      <div class="title-inner">НАСТРОЙКИ</div>
    </div>
  </div>

  <div class="body billing-page">

    @market.lk.lkBlock("Биллинг") {

      @* Верхняя информация: баланс, тарификация *@
      <table class="siom-table __size-XL">

        @ctx.billBalanceOpt.map { mbb =>
        <tr>
          <td>
            <div class="table-cell-cnt __size-M" style="padding-left: 0;">
              <span class="prop-title">Доступные средства:</span>
            </div>

            <div class="table-cell-cnt __size-M">
              <span class="value big">@formatPrice(mbb.amount, mbb.currency)</span>
            </div>

            <br/>

            <div class="table-cell-cnt __size-M" style="padding-left: 0;">
              <span class="prop-title">Всего денег:</span>
            </div>

            <div class="table-cell-cnt __size-M">
              <span class="value big">@formatPrice(mbb.amount + mbb.blocked, mbb.currency)</span>
            </div>

            <br/>

            <div class="table-cell-cnt __size-M" style="padding-left: 0;">
              <span class="prop-title">Заблокиро-<br/>вано:</span>
            </div>

            <div class="table-cell-cnt __size-M">
              <span class="value big">@formatPrice(mbb.blocked, mbb.currency)</span>
            </div>
          </td>

          <td>
            <div class="border-line __vertical js-vertical-line f-left"></div>
            <div class="table-cell-cnt __size-M">
              <span class="prop-title">Списание средств:</span>
            </div>
          </td>
          <td>
            <div class="border-line __vertical js-vertical-line f-right"></div>
            <div class="table-cell-cnt __size-M">
                <span class="value f-left" style="padding-top: 5px;">18.05.2014</span>

                <span class="gray-but-smallest inline f-left" style="margin-left: 20px;">
                  <a  class="white-border-top" id="getTransactions" data-init="true" href="@routes.MarketLkBilling._txnsList(adnNode.id.get)">История операций</a>
                </span>

            </div>
          </td>

          <td style="vertical-align: top; padding-top: 10px;">
            <div class="table-cell-cnt __size-M" style="padding-top: 0; padding-bottom: 0;">
              <a class="siom-link-btn __size-M __ft-L __color-5 js-slide-btn" data-fix-title="true"  href="#requisites">РЕКВИЗИТЫ</a>
            </div>
          </td>

        }
      </table>

    }<!-- Верхняя информация end -->

    <div class="siom-block-child" id="requisites">
      @market.lk.lkBlock("Реквизиты платежа:") {

        @* Реквизиты платежа *@
        @_billPaymentBankTpl(mbc)
        <span class="gray-but-smallest" style="margin-top: 25px;">
          <a class="white-border-top" href="@routes.MarketLkBilling.paymentRequsites(adnNode.id.get)">Распечатать</a>
        </span>

      }
    </div>


    <div class="siom-block-child" id="transactionsHistory">
      @market.lk.lkBlock("История операций") {

        <table class="siom-table __size-XL" id="transactionsList">
          <tr>
            <th class="__bg-head">
              <div class="table-cell-cnt __size-S">
                №
              </div>
              <div class="border-line"></div>
            </th>
            <th class="__bg-head">
              <div class="table-cell-cnt __size-S">
                Основание:
              </div>
              <div class="border-line"></div>
            </th>
            <th class="__bg-head">
              <div class="table-cell-cnt __size-S">
                Дата операции:
              </div>
              <div class="border-line"></div>
            </th>
            <th class="__bg-head">
              <div class="table-cell-cnt __size-S ">
                Сумма:
              </div>
              <div class="border-line"></div>
            </th>
          </tr>
        </table>

      }
    </div><!-- История операции end -->



    @* Посуточная mmp-тарифная сетка этого узла-ресивера. Если не ресивер, то в шаблон придёт пустой список. *@
    @if(!mmpDailyTariffs.isEmpty) {

      @market.lk.lkBlock("Ставка тарифных планов") {

          @_dailyMmpTariffPlansTpl(mmpDailyTariffs, adnNode)

      }

    }


    @* Если продьюсер, то надо отобразить список узлов-ресиверов, на которые можно разместить рекламную карточку.
       Содержимое узла (тарифная сетка) рендерится асинхронно при нажатии кнопки "развернуть" в списке. *@
    @if(!otherRcvrs.isEmpty) {

      @market.lk.lkBlock("Ставка тарифных планов рекламного размещения") {

        @* Пока без вкладок, просто сплошным списком. *@
        @otherRcvrs.map { rcvr =>

          @* При развертывании элемента нужно слать запрос по указанной ссылке. При повторном развертывании нужно отображать уже полученную табличку тарифов. *@
          @market.lk.lkBlock( rcvr.meta.name + " / " + rcvr.meta.town.get, slideBtnHref = routes.MarketLkBilling._renderNodeMbmds(rcvr.id.get) ) { }


        }

      }

    }

  </div>

}
