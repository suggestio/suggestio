@(adnNode: MAdnNode, mmpDailyTariffs: Seq[MBillMmpDaily], txns: Seq[MBillTxn], mbc: MBillContract, otherRcvrs: Seq[MAdnNode])(implicit ctx: util.Context)

@* Страница с информацией по биллингу для узла рекламной сети. *@
@import ctx._
@import util.TplDataFormatUtil._
@import datetime._

@market.lk.lkBase("Биллинг | " + adnNode.meta.name, adnIdOpt = adnNode.id) {

  <div class="title-wrap">
    <div class="center">
      <a class="back-but" href="@routes.MarketLkAdn.showAdnNode(adnNode.id.get)">&nbsp;</a>
      <div class="title-inner">БАЛАНС</div>
    </div>
  </div>

  <div class="body billing-page">

    @* Верхняя информация: баланс, тарификация *@
    <table class="top-info">


      @ctx.billBalanceOpt.map { mbb =>

        <td>
          <div class="ovh" style="padding-left: 0;">
            <span class="gray font-12">Текущий баланс:</span>
          </div>
        </td>
        <td>
          <div class="ovh">
            <span class="value big">@formatPrice(mbb.amount, mbb.currency)</span>
          </div>
        </td>

      }

    </table>
    <div class="border-line"></div>


    <div class="mid-info">
      @* Реквизиты платежа *@

      <div class="f-left gray font-12">
        Реквизиты:
      </div>
      <div class="ovh">
        @_billPaymentBankTpl(mbc)
        <span class="gray-but-smallest">
          <a class="white-border-top" href="@routes.MarketLkBilling.paymentRequsites(adnNode.id.get)">Распечатать</a>
        </span>

      </div>
    </div>


    @* История транзакций *@
    <div class="transactions-history">

      @if(!txns.isEmpty) {
        <div class="title">
          <strong>История операций:</strong>
          <a class="toggle" href="#">Развернуть</a>
        </div>
        <div class="border-line"></div>
        <div class="transactions-list">
          @txns.map { txn =>
            <div class="item">
              <div class="f-left">
                <strong>@txn.paymentComment</strong> / <span title="@_prettyDate(txn.datePaid).toString.trim">@numericDate(txn.datePaid)</span>
              </div>
              <div class="ovh">
                Сумма: <strong>@formatPrice(txn.amount, txn.currency)</strong>
              </div>
            </div>
            <div class="border-line"></div>
          }
        </div>
      }

    </div>


    @* Посуточная mmp-тарифная сетка этого узла-ресивера. Если не ресивер, то в шаблон придёт пустой список. *@
    @if(!mmpDailyTariffs.isEmpty) {
      <div>
        <h4>Ставка тарифных планов</h4>
        @_dailyMmpTariffPlansTpl(mmpDailyTariffs, adnNode)
      </div>
    }

    @* Если продьюсер, то надо отобразить список узлов-ресиверов, на которые можно разместить рекламную карточку.
       Содержимое узла (тарифная сетка) рендерится асинхронно при нажатии кнопки "развернуть" в списке. *@
    @if(!otherRcvrs.isEmpty) {
      @* Пока без вкладок, просто сплошным списком. *@
      @otherRcvrs.map { rcvr =>
        @rcvr.meta.name / @rcvr.meta.town
        @* При развертывании элемента нужно слать запрос по указанной ссылке. При повторном развертывании нужно отображать уже полученную табличку тарифов. *@
        <a href="@routes.MarketLkBilling._renderNodeMbmds(rcvr.id.get)">Развернуть</a>
      }
    }

  </div>

}
