@(adnNode: MAdnNode, mmpDailyTariffs: Seq[MBillMmpDaily], mbc: MBillContract, otherRcvrs: Seq[MAdnNode])(implicit ctx: util.Context)

@* Страница с информацией по биллингу для узла рекламной сети. *@
@import ctx._
@import util.TplDataFormatUtil._
@import datetime._

@rightBar = {
  <nav class="right-bar_menu">
    <a class="right-bar_menu-i def-transition __act" href="@routes.MarketLkBilling.showAdnNodeBilling(adnNode.id.get)">Биллинг тарифных планов</a>
    <hr class="delimiter"/>
    <a class="right-bar_menu-i def-transition" href="@routes.MarketLkBilling._txnsList(adnNode.id.get)">История операций</a>
    <hr class="delimiter"/>
    <a class="right-bar_menu-i def-transition" href="@routes.MarketLkBilling.paymentRequsites(adnNode.id.get)">Реквизиты</a>
    <hr class="delimiter"/>
  </nav>
}



@market.lk.lkBaseLayout(
  title    = "Биллинг | " + adnNode.meta.name,
  adnIdOpt = adnNode.id,
  leftCurrEl = Some(LkLeftPanelLinks.LPL_BILLING),
  rightBar  = Some(rightBar)
) {

  @ctx.billBalanceOpt.map { mbb =>

    <hr class="delimiter __light"/>

    <div class="billing_money-info">
      <div class="billing_all-money">
        <span class="light-gray">Всего на счете</span>
        <div class="dark-gray billing_money-value">@formatPrice(mbb.amount + mbb.blocked, mbb.currency)</div>
      </div>

      <div class="billing_available-money">
        <span class="light-gray">Доступно для операции</span>
        <div class="dark-gray billing_money-value">@formatPrice(mbb.amount, mbb.currency)</div>
      </div>

      <div class="billing_locked-money">
        <span class="light-gray">Заблокировано</span>
        <div class="dark-gray billing_money-value">@formatPrice(mbb.blocked, mbb.currency)</div>
      </div>
    </div>
  }

  <h2 class="minor-title">
    Ставка тарифных планов моего магазина
  </h2>
  <hr class="delimiter __light"/>
  @* Посуточная mmp-тарифная сетка этого узла-ресивера. Если не ресивер, то в шаблон придёт пустой список. *@
  @if(!mmpDailyTariffs.isEmpty) {
    @_dailyMmpTariffPlansTpl(mmpDailyTariffs, adnNode)
  }


    @* Если продьюсер, то надо отобразить список узлов-ресиверов, на которые можно разместить рекламную карточку.
       Содержимое узла (тарифная сетка) рендерится асинхронно при нажатии кнопки "развернуть" в списке. *@
    @if(!otherRcvrs.isEmpty) {

      @market.lk.lkBlock("Ставка тарифных планов рекламного размещения") {

        @* Пока без вкладок, просто сплошным списком. *@
        @otherRcvrs.map { rcvr =>

          @* При развертывании элемента нужно слать запрос по указанной ссылке. При повторном развертывании нужно отображать уже полученную табличку тарифов. *@
          @market.lk.lkBlock( rcvr.meta.name + " / " + rcvr.meta.town.get, slideBtnHref = routes.MarketLkBilling._renderNodeMbmds(rcvr.id.get) ) { }


        }

      }

    }


}
