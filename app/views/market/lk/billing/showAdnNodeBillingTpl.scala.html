@(adnNode: MAdnNode, mmpDailyTariffs: Seq[MBillMmpDaily], mbc: MBillContract, otherRcvrs: Seq[MAdnNode])(implicit ctx: util.Context)

@* Страница с информацией по биллингу для узла рекламной сети. *@
@import ctx._
@import util.TplDataFormatUtil._
@import datetime._


@content = {

  @ctx.billBalanceOpt.map { mbb =>

    <hr class="delimiter __light"/>

    <div class="billing_money-info">
      <div class="billing_all-money">
        <span class="light-gray">Всего на счете</span>
        <div class="dark-gray billing_money-value">@formatPrice(mbb.amount + mbb.blocked, mbb.currency)</div>
      </div>

      <div class="billing_available-money">
        <span class="light-gray">Доступно для операции</span>
        <div class="dark-gray billing_money-value">@formatPrice(mbb.amount, mbb.currency)</div>
      </div>

      <div class="billing_locked-money">
        <span class="light-gray">Заблокировано</span>
        <div class="dark-gray billing_money-value">@formatPrice(mbb.blocked, mbb.currency)</div>
      </div>
    </div>
  }

  @* Посуточная mmp-тарифная сетка этого узла-ресивера. Если не ресивер, то в шаблон придёт пустой список. *@
  @if(!mmpDailyTariffs.isEmpty) {

    <h2 class="minor-title">
      Ставка тарифных планов моего магазина
    </h2>
    <hr class="delimiter __light"/>

    @mmpDailyTariffs.map { mbmd =>
      <div class="tariff">
        @_dailyMmpTariffPlanTpl(mbmd, adnNode)
      </div>
    }
  }



  @* Если продьюсер, то надо отобразить список узлов-ресиверов, на которые можно разместить рекламную карточку.
     Содержимое узла (тарифная сетка) рендерится асинхронно при нажатии кнопки "развернуть" в списке. *@
  @if(!otherRcvrs.isEmpty) {

    <h2 class="minor-title">
      Ставка тарифных планов рекламного размещения
    </h2>
    <hr class="delimiter __light"/>

    <!-- TODO привязать к верстке логику -->
    <!--<div class="tab_lst">
      <a class="tab_i __js-act">Все</a>
      <a class="tab_i">Санкт-Петербург</a>
      <a class="tab_i">Москва</a>
    </div>-->

    @* Пока без вкладок, просто сплошным списком. *@
    @otherRcvrs.map { rcvr =>
      @* При развертывании элемента нужно слать запрос по указанной ссылке. При повторном развертывании нужно отображать уже полученную табличку тарифов. *@

      @market.lk.lkBlockNewDesign(
        href = Some( routes.MarketLkBilling._renderNodeMbmds(rcvr.id.get)),
        open = false
      ) { @rcvr.meta.name&nbsp;/&nbsp;<span class="ft-S light-gray">@rcvr.meta.town</span> } { }

    }

  }

}


@billingBaseTpl(
  title         = "Биллинг",
  node          = adnNode,
  rightCurrEl   = BillingRightPanelLinks.RPL_BILLING
)(content)