@(node: MAdnNode, mads: Seq[MAd] = Nil, canAdv: Boolean, ad2advMap: Map[String, MAdvI])(implicit ctx: Context)

@* Список рекламных карточек для создателя рекламы. В нём галочки есть. *@
@import market.lk.ad._

@* Флаг single переименовывает единственную галочку "Выводить". *@
@defining(node.adn.showLevelsInfo.out4render) { outLvlMap =>

  @* Раскрыть для скриптов текущую информацию о лимитах по кол-ву объяв на доступных уровнях отображения. *@
  @outLvlMap.map { case (sl, (slAllowed, slMax)) =>
    <input id="maxShownAds_@sl" type="hidden" value="@slMax"/>
  }

  @_adsListOuterTpl {

    <div class="ads-list__block ads-list-block">
      <a class="ads-list-block__link" href="@routes.MarketAd.createAd(node.id.get)" style="background: none;"></a>
      <div class="ads-list-block__preview ads-list-block__preview_add-new">
      </div>
    </div>

    @defining(outLvlMap.size == 1) { isSingleOutLvl =>
      @_adsListTpl(mads, coverDisableReason = true) { mad =>

        <div class="js-equal-height">
        @ad2advMap.get(mad.id.get) match {
          case Some(advReq: MAdvReq) => {
            <a class="ads-list-block__link ads-list-block__link_inactive js-btn" href="@routes.MarketAdv.advFullWnd(mad.id.get)">Находится<br/>на рассмотрении<br/>администратора</a>
          }
          case Some(advOk : MAdvOk) => {
            <a class="ads-list-block__link ads-list-block__link_inactive js-btn" href="@routes.MarketAdv.advFullWnd(mad.id.get)">Находится<br/>в размещении</a>
          }
          case _ => {
            <a class="ads-list-block__link" href="@routes.MarketAd.editAd(mad.id.get)">Нажмите для<br/>редактирования</a>
          }
        }

        @* Галочки для управления отображением рекламной карточки магазина.
           Отображаются, если модератор не запретил бесплатное размещение этой карточки. *@
        @mad.moderation.freeAdv.filter(!_.isAllowed).fold {
          @* Бесплатное размещение не запрещено. *@
          <div class="ads-list-block__controls">
            @defining(mad.allWantShowLevels) { adSls =>
              @* Обходим карту уровней, переводя её в список галочек. *@
              @outLvlMap.map { case (sl, (slAllowed, slMax)) =>
                @defining(node.adn.canOutAtLevel(sl)) { hl =>
                  <label class="@sl.checkboxCssClass@if(!slAllowed){ inactive}">
                    <input class="@if(slMax == 1){one-}checkbox" type="checkbox"
                           data-level="@sl" data-adid="@mad.id" data-name="@sl.checkboxCssClass"
                           @if(!slAllowed) {disabled="disabled"} @if(adSls contains sl) {data-checked="checked"}
                           />&nbsp;@Messages(if(isSingleOutLvl) "lk.sl.enable_ad" else "lk.sl." + sl.name)
                  </label>
                }
              }
            }
          </div><!-- .ads-list-block__controls end -->
        } { faMdr =>
          @* Модератор запретил бесплатное размещение указанное карточки. *@
          @faMdr.reason
        }
        </div><!-- .js-equal-height end -->
          @if(canAdv) {
              <a class="siom-link-btn __ft-L __size-XL __color-1" href="@routes.MarketAdv.advForAd(mad.id.get)">
                УПРАВЛЕНИЕ
              </a>
          }


      } @* ads list*@
    }

    <div class="clear"></div>
  }
}
