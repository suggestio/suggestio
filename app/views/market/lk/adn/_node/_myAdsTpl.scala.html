@(node: MAdnNode, mads: Seq[MAdT] = Nil, canAdv: Boolean, busyAdIds: Set[String])(implicit ctx: util.Context)

@* Список рекламных карточек для создателя рекламы. В нём галочки есть. *@
@import market.lk.ad._

@* Флаг single переименовывает единственную галочку "Выводить". *@
@defining(node.adn.showLevelsInfo.out4render) { outLvlMap =>

  @* Раскрыть для скриптов текущую информацию о лимитах по кол-ву объяв на доступных уровнях отображения. *@
  @outLvlMap.map { case (sl, (slAllowed, slMax)) =>
    <input id="maxShownAds_@sl" type="hidden" value="@slMax"/>
  }

  @_adsListOuterTpl {

    <div class="ads-list__block ads-list-block">
      <a class="ads-list-block__link" href="@routes.MarketAd.createAd(node.id.get)" style="background: none;"></a>
      <div class="ads-list-block__preview ads-list-block__preview_add-new">
      </div>
    </div>

    @defining(outLvlMap.size == 1) { isSingleOutLvl =>
      @_adsListTpl(mads, coverDisableReason = true) { mad =>
        @if(busyAdIds contains mad.id.get) {
          <a class="ads-list-block__link ads-list-block__link_inactive">Находится<br/>на рассмотрении<br/>администратора</a>
        } else {
          <a class="ads-list-block__link" href="@routes.MarketAd.editAd(mad.id.get)">Нажмите для<br/>редактирования</a>
        }

        @* Галочки для управления отображением рекламной карточки магазина. *@
        <div class="ads-list-block__controls">
          @defining(mad.allWantShowLevels) { adSls =>
            @* Обходим карту уровней, переводя её в список галочек. *@
            @outLvlMap.map { case (sl, (slAllowed, slMax)) =>
              @defining(node.adn.canOutAtLevel(sl)) { hl =>
                <label class="@sl.checkboxCssClass@if(!slAllowed){ inactive}">
                  <input class="@if(slMax == 1){one-}checkbox" type="checkbox"
                         data-level="@sl" data-adid="@mad.id" data-name="@sl.checkboxCssClass"
                         @if(!slAllowed) {disabled="disabled"} @if(adSls contains sl) {data-checked="checked"}
                         />&nbsp;@Messages(if(isSingleOutLvl) "lk.sl.enable_ad" else "lk.sl." + sl.name)
                </label>
              }
            }
          }

          @if(canAdv) {

            @if(busyAdIds contains mad.id.get) {
              <a class="sm-large-button sm-large-button_disabled"><span>УПРАВЛЕНИЕ</span></a>
            } else {
              <a class="sm-large-button" href="@routes.MarketAdv.advForAd(mad.id.get)"><span>УПРАВЛЕНИЕ</span></a>
            }

          }

        </div>
      } @* ads list*@
    }

    <div class="clear"></div>
  }
}
