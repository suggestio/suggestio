@(af: Form[_], isShown:Boolean = false)(implicit ctx: util.Context)

@* Discount-часть формы: текст и скидка. *@

@import ctx._
@import helper._
@import util.FormHelpers.myFields
@import controllers.ad.MarketAdFormUtil.{DISCOUNT_TPL_ID_MIN, DISCOUNT_TPL_ID_MAX}

@* TODO: Удалить, когда переезд на blocks будет завершен. *@

@mkField(isBig: Boolean)(content: Html) = {
  <table cellpadding="0" cellspacing="0" class="input-wrap@if(isBig){ big}">
    <tr>@content</tr>
  </table>
}

@* Подшаблон для выбора цвета фона discount-шаблона. *@
@tplColorItem(color: String, colorId: String) = {
  <div class="item">
    @defining(af("ad.offer.template.color").value) { cv =>
      <input type="checkbox" class="one-checkbox" name="ad.offer.template.color" value="@color" data-name="mask-color" data-value="@color"
      @if(cv.exists(_ equalsIgnoreCase color)  ||  (cv.isEmpty && color == "ce2222")) {data-checked = "checked"}/>
      <div class="color" style="background: #@color;">&nbsp;</div>
    }
  </div>
}

<div class="tab-content"@if(!isShown) { style="display: none;"}>
  @mkField(true) {
    @inputText(
      af("ad.offer.text1.value"),
      '_label -> "Текст сверху:",
      'id     -> "text1ValueInput"
    )
    @_selectColorTpl("ad.offer.text1.color", af)

    @if(af("ad.offer.text1.value").hasErrors) {
      <tr>
        <td class="left">&nbsp;</td>
        <td class="err-msg" colspan="2">
          Поле заполнено некорректно!
        </td>
      </tr>
    }

  }

  @mkField(false) {
    @inputText(
      af("ad.offer.discount.value"),
      '_label -> "Скидка в процентах:",
      'id     -> "discountValueInput"
    )
    @_selectColorTpl("ad.offer.discount.color", af)

    @if(af("ad.offer.discount.value").hasErrors) {
      <tr>
        <td class="left">&nbsp;</td>
        <td class="err-msg" colspan="2">
          Поле заполнено некорректно!
        </td>
      </tr>
    }

  }

  @mkField(true) {
    @inputText(
      af("ad.offer.text2.value"),
      '_label -> "Текст снизу:",
      'id -> "text2ValueInput"
    )
    @_selectColorTpl("ad.offer.text2.color", af)

    @if(af("ad.offer.text2.value").hasErrors) {
      <tr>
        <td class="left">&nbsp;</td>
        <td class="err-msg" colspan="2">
          Поле заполнено некорректно!
        </td>
      </tr>
    }

  }

  <table cellpadding="0" cellspacing="0" class="mask-list input-wrap big">
    <tr>
      <td class="left @if(af("ad.offer.template.id").hasErrors) {err-msg}">
        <label>Шаблон:</label>
      </td>

      <td class="right">
        @defining(DISCOUNT_TPL_ID_MIN to DISCOUNT_TPL_ID_MAX) { is => @is.map { i =>
          @defining(i.toString) { istr =>
          <div class="item mask-@i">

            <input type="checkbox" class="one-checkbox" name="ad.offer.template.id" value="@i" data-name="mask"
            @if(af("ad.offer.template.id").value.exists(_ == istr)) {data-checked = "checked"}
            @if(!af("ad.offer.template.id").value && i == 1) {data-checked = "checked"} />
          </div>
        }}}
      </td>
    </tr>
  </table>

  <table cellpadding="0" cellspacing="0" class="color-list input-wrap big">
    <tr>
      <td class="left @if(af("ad.offer.template.id").hasErrors) {err-msg}">
        <label>Цвет шаблона:</label>
      </td>

      <td class="right">
        @tplColorItem("ce2222", "1")
        @tplColorItem("fee800", "2")
        @tplColorItem("e3a51a", "3")
        @tplColorItem("4fce22", "4")
      </td>
    </tr>
  </table>

</div><!-- .tab-content end -->
