@(af: Form[_], call: Call, btnText: String, mmcats: CollectMMCatsAcc_t, offerType: AdOfferType, adnNode: MAdnNode)(implicit ctx: util.Context)

@* Рендер формы редактирования произвольной рекламы.
 * offerType - предпочитаемый тип оффера, когда он неизвестен.
*@
@import ctx._
@import helper._
@import AdOfferTypes._
@import util.blocks._

@helper.javascriptRouter("jsRoutes")(
  routes.javascript.MarketCategory.topCatsOf,
  routes.javascript.MarketCategory.directSubcatsOf
)

@* Определяем текущий тип оффера (тип формы). Используем данные формы и аргумент offerType как fallback. *@
@defining(af("ad.offer.mode").value.flatMap(AdOfferTypes.maybeWithName).getOrElse(offerType)) { offerType1 =>
@form(call, 'id -> "promoOfferForm") {

  @* Бывает, что у формы задана ошибка верхнего уровня. Такое происходит например если ad.mode не верен. *@
  @*af.globalError*@

  <input type="hidden" id="preview-action" value="@routes.MarketAdPreview.adFormPreviewSubmit(adnNode.id.get)" />

  <div class="lk-edit-form__block">
    <div class="lk-edit-form__block-title">
      Выбор категории
    </div>

    <div class="lk-edit-form__block-body">
      @_adFormCatSelectorsTpl(mmcats, af)
    </div>

  </div>

  @* Тут выводится список блоков в виде иконок. При нажатии — производится запрос для рендера нужного редактора блока *@
  <div class="lk-edit-form__block">
    <div class="lk-edit-form__block_title">
      Выбор шаблона
    </div>
    <div class="lk-edit-form__block_body">

      <div class="lk-edit-form__blocks-list-icons" id="adFormBlocksList">
      @BlocksConf.values.map { bc =>
        <div class="blocks-list-icons__single-icon blocks-list-icons__single-icon_active block-list-icon-@bc.id" data-block-id="@bc.id">
        </div>
      }

      <input class="block-editor-action" type="hidden" value="@routes.MarketAdPreview.adBlockSwitchEditor(adnNode.id.get)"/>
      <div class="clear"></div>
      </div>

    </div>
  </div>

  @* Для блока : превьюшка + редактор *@
  <div class="lk-edit-form__block">
    <div class="lk-edit-form__block_title">
      Отображение рекламной карточки
    </div>
    <div class="lk-edit-form__block_body">

      @* Форма редактирования блока *@
      <div class="lk-ad-block-edit-form">

        @* Отображение превьюшки *@
        <div class="lk-ad-block-edit-form__preview">

          @* TODO: в этот div надо рендерить превьюшку *@
          <input class="js-ad-block-preview-action" type="hidden" value="@routes.MarketAdPreview.adFormPreviewSubmit(adnNode.id.get)"/>

          <div class="lk-ad-block-edit-form__preview_container" id="adFormBlockPreview">

          </div>
          <div class="clear"></div>

        </div>

        @* Отображение нужного редактора *@
        <div class="lk-ad-block-edit-form__editor" id="adFormBlockEditor">
          @blocks.editor._blockEditorTpl(af)
        </div>

        <div class="clear"></div>

      </div>

    </div>
  </div>

  @* Режим формы (тип рекламного оффера). Должен переключаться при переключении вкладки. *@
  <input id="ad-mode" type="hidden" name="ad.offer.mode" value="@offerType1.toString"/>

}
}

