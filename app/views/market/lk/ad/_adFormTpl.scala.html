@(af: Form[_], call: Call, btnText: String, mmcats: CollectMMCatsAcc_t, withBC: Option[BlockConf], adnNode: MAdnNode)(implicit ctx: util.Context)

@* Рендер формы редактирования произвольной рекламы.
 * offerType - предпочитаемый тип оффера, когда он неизвестен.
*@
@import ctx._
@import helper._
@import AdOfferTypes._
@import util.blocks._

@helper.javascriptRouter("jsRoutes")(
  routes.javascript.MarketCategory.topCatsOf,
  routes.javascript.MarketCategory.directSubcatsOf
)

@* Определяем текущий тип оффера (тип формы). Используем данные формы и аргумент offerType как fallback. *@
@form(call, 'id -> "promoOfferForm") {

  @* Бывает, что у формы задана ошибка верхнего уровня. Такое происходит например если ad.mode не верен. *@
  @*af.globalError*@

  <input type="hidden" id="preview-action" value="@routes.MarketAdPreview.adFormPreviewSubmit(adnNode.id.get)" />

  <div class="lk-edit-form__block js-slide-wrap">
    <div class="lk-edit-form__block_title">
      <div class="border-line"></div>
      <span class="lk-edit-form__block_title_span">
        Выбор категории
      </span>
      <a href="#" class="js-g-slide-toggle open l-right">Свернуть</a>
      <div class="border-line"></div>
    </div>

    <div class="lk-edit-form__block_body js-slide-content">
      <div class="lk-edit-form__block_body_inner">
        @_adFormCatSelectorsTpl(mmcats, af)
      </div>
    </div>

  </div>

  @* Тут выводится список блоков в виде иконок. При нажатии — производится запрос для рендера нужного редактора блока *@
  <div class="lk-edit-form__block js-slide-wrap">
    <div class="lk-edit-form__block_title">
      <div class="border-line"></div>
      <span class="lk-edit-form__block_title_span">
        Выбор шаблона
      </span>
      <a href="#" class="js-g-slide-toggle open l-right">Свернуть</a>
      <div class="border-line"></div>
    </div>
    <div class="lk-edit-form__block_body js-slide-content">

      <div class="lk-edit-form__block_body_inner">

        <div class="lk-edit-form__blocks-list-icons" id="adFormBlocksList">
        @defining( withBC getOrElse BlocksConf(1) ) { bc =>
          @BlocksConf.valuesSorted.map { bca =>
            <div class="blocks-list-icons__single-icon @if( bc.id == bca.id ){blocks-list-icons__single-icon_active} block-list-icon-@bca.id" data-block-id="@bca.id"></div>
          }
        }

        <input class="block-editor-action" type="hidden" value="@routes.MarketAdPreview.adBlockSwitchEditor(adnNode.id.get)"/>
        <div class="clear"></div>
        </div>

      </div>

    </div>
  </div>

  @* Для блока : превьюшка + редактор *@
  <div class="lk-edit-form__block js-slide-wrap">
    <div class="lk-edit-form__block_title">
      <div class="border-line"></div>
      <span class="lk-edit-form__block_title_span">
        Отображение рекламной карточки
      </span>
      <a href="#" class="js-g-slide-toggle open l-right">Свернуть</a>
      <div class="border-line"></div>
    </div>
    <div class="lk-edit-form__block_body js-slide-content">

      <div class="lk-edit-form__block_body_inner">

        @* Форма редактирования блока *@
        <div class="lk-ad-block-edit-form">

          @* Отображение превьюшки *@
          <div class="lk-ad-block-edit-form__preview">

            @* TODO: в этот div надо рендерить превьюшку *@
            <input class="js-ad-block-preview-action" type="hidden" value="@routes.MarketAdPreview.adFormPreviewSubmit(adnNode.id.get)"/>

            <div class="lk-ad-block-edit-form__preview_container" id="adFormBlockPreview">

            </div>
            <div class="clear"></div>

          </div>

          @* Отображение нужного редактора *@
          <div class="lk-ad-block-edit-form__editor" id="adFormBlockEditor">
            @blocks.editor._blockEditorTpl(af, withBC = withBC)
          </div>

          <div class="clear"></div>

        </div>

      </div>

    </div>
  </div>


  @* HTML-редактор для ввода текстового описания. *@
  <div class="lk-edit-form__block js-slide-wrap">
    <div class="lk-edit-form__block_title">
      <div class="border-line"></div>
      <span class="lk-edit-form__block_title_span">
        Описание
      </span>
      <a href="#" class="js-g-slide-toggle open l-right">Свернуть</a>
      <div class="border-line"></div>
    </div>

    <div class="lk-edit-form__block_body js-slide-content">
      <div class="lk-edit-form__block_body_inner">

        <table class="input-wrap big tinymce">
          <td class="tinymce_editor">
            @*textarea(af("ad.descr.text"))*@
            <textarea class="js-tinymce" id="ad_descr_text" name="ad.descr.text">
              @af("ad.descr.text").value
            </textarea>
          </td>

          @_selectColorTpl(af("ad.descr.bgColor"))
        </table>

      </div>
    </div>

  </div>


  @* Режим формы (тип рекламного оффера). Должен переключаться при переключении вкладки. *@
  <input id="ad-mode" type="hidden" name="ad.offer.mode" value="@AdOfferTypes.BLOCK"/>

}

