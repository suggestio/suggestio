@(af: Form[_], call: Call, mmcats: CollectMMCatsAcc_t, withBC: Option[BlockConf], adnNode: MAdnNode, allBlocks: Seq[BlockConf])(implicit ctx: Context)

@* Рендер формы редактирования произвольной рекламы.
 * offerType - предпочитаемый тип оффера, когда он неизвестен.
 *@
@import ctx._
@import helper._
@import AdOfferTypes._
@import util.blocks._

@helper.javascriptRouter("jsRoutes")(
  routes.javascript.MarketCategory.topCatsOf,
  routes.javascript.MarketCategory.directSubcatsOf
)

@* Определяем текущий тип оффера (тип формы). Используем данные формы и аргумент offerType как fallback. *@
@form(call, 'id -> "promoOfferForm") {

  @* Бывает, что у формы задана ошибка верхнего уровня. Такое происходит например если ad.mode не верен. *@
  @*af.globalError*@

  <input type="hidden" id="preview-action" value="@routes.MarketAdPreview.adFormPreviewSubmit(adnNode.id.get, isFull = false)" />

  @market.lk.lkBlock("Выбор категории", cntSubClass = "__innerVisible") {
    @_adFormCatSelectorsTpl(mmcats, af)
  }


  @* Для блока : превьюшка + редактор *@
  @market.lk.lkBlock("Отображение рекламной карточки") {

    @* Форма редактирования блока *@
    <div class="lk-ad-block-edit-form">

      @* Отображение превьюшки *@
      <div class="lk-ad-block-edit-form__preview">

        @* TODO: в этот div надо рендерить превьюшку *@
        <input class="js-ad-block-preview-action" type="hidden" value="@routes.MarketAdPreview.adFormPreviewSubmit(adnNode.id.get, isFull = false)"/>
        <input class="js-ad-block-full-preview-action" type="hidden" value="@routes.MarketAdPreview.adFormPreviewSubmit(adnNode.id.get, isFull = true)"/>

        <div class="lk-ad-block-edit-form__preview_container" id="adFormBlockPreview">

        </div>
        <div class="clear"></div>

      </div>

      @* Отображение нужного редактора *@
      <div class="lk-ad-block-edit-form__editor" id="adFormBlockEditor">
        @blocks.editor._blockEditorTpl(af, withBC = withBC)
      </div>

      @* 2014.nov.26: Новая галочка "паттерн" для задания покрывающей сетки указанного цвета. *@
      @checkbox(af("ad.pattern.enabled"), '_label -> "Паттерн")
      @_selectColorTpl(af("ad.pattern.color"), label = "Цвет паттерна")

      <div class="clear"></div>

    </div>

  }


  @* HTML-редактор для ввода текстового описания. *@
  @market.lk.lkBlock("Описание") {

    <table class="input-w __size-L tinymce">

      <td class="input-w_tinymce-editor">
        <textarea class="js-tinymce" id="ad_descr_text" name="ad.descr.text">
          @af("ad.descr.text").value
        </textarea>
      </td>

      @_selectColorTpl(af("ad.descr.bgColor"), label = "Цвет фона")
    </table>

  }

  @* Режим формы (тип рекламного оффера). Должен переключаться при переключении вкладки. *@
  <input id="ad-mode" type="hidden" name="ad.offer.mode" value="@AdOfferTypes.BLOCK"/>

}

