@(title: String, leftCurrEl: Option[LkLeftPanelLink] = None, nodeOpt: Option[MAdnNode] = None,
  headAfter:Option[Html] = None, popupContent: Option[Html] = None,
  povAdnId: Option[String] = None)(content: Html)(implicit ctx: Context)

@* Базовый шаблон для личного кабинета sio-маркета (не важно: ТЦ или магазин).
   - Параметр headAfter содержит дополнения к телу тега head.
*@
@import ctx._
@import stuff._
@import LkLeftPanelLinks._

<!DOCTYPE html>
<html>
<head>
  <title>
    @title
    @if(nodeOpt) { | }
    @_nodeTitleTpl(nodeOpt)
    | market | Suggest.io
  </title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("javascripts/lib/colorpicker/css/colorpicker.css")'/>

  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/lk/common.css")'/>
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/showcase.css")'/>
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/showcase_previews.css")'/>
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("javascripts/lib/lightbox/css/lightbox.css")'/>
  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("javascripts/lib/bxslider/jquery.bxslider.css")'/>

  <link rel="stylesheet" type="text/css" href='@routes.Assets.versioned("stylesheets/market/lk_new-design/lk.css")'/>

  <script src='@routes.Assets.versioned("javascripts/jquery.min.js")'></script>
  @headAfter
</head>

@defining( nodeOpt.flatMap(_.id)) { adnIdOpt =>
<body class="lk">

    <header class="header">
      <a class="header_logo-link" href="@routes.Market.index()">
        <img class="header_logo-image" src='@routes.Assets.versioned("images/market/new-design/logo_retina.png")' alt="logo" width="53" height="51"/>
      </a>

      <div class="header_cnt">

        @if(nodeOpt.isEmpty) {
          <img class="header_logo-text" src='@routes.Assets.versioned("images/market/index/logo_retina.png")' width="101" height="26"/>
        } else {
          @nodeOpt.map { node =>
            <span class="header_logo-text">@node.meta.name</span>
          }
        }

        @adnIdOpt.map { adnId =>
          @* Виджет для отображения денег на счете и доступа к финансовым функциям. Только в контексте узла. *@
          @billing._billBallanceWidgetTpl(adnId)
        }
      </div>

      @ctx.usernameOpt.map { username =>
        <a class="header_logout light-gray dark-link" href="@routes.Ident.logout" title="Выйти">@username</a>
      }
    </header>


    <section class="page">

      @* Отрендерить уведомления, которые появляются после сабмитов с последующими редиректами. *@
      @ctx.flashMap.map { case (flashStatus, flashMsg) =>
        <div style="display: none;" class="status-bar ft-L @if(flashStatus == "success") {__good} else {__bad}">
          <div class="status-bar_cnt">
            @flashMsg
          </div>
        </div>
      }

      <aside class="left-bar">
        @adnIdOpt.map { adnId =>
          <nav class="left-bar_menu">
            <a class="left-bar_menu-i __cards@if(leftCurrEl contains LPL_ADS){ __act}" href="@routes.MarketLkAdn.showNodeAds(adnId, povAdnId = povAdnId)" title="Рекламные карточки"></a>
            <hr class="delimiter"/>
            <a class="left-bar_menu-i __profile@if(leftCurrEl contains LPL_NODE){ __act}"  href="@routes.MarketLkAdn.showAdnNode(adnId, povAdnId = povAdnId)" title="Профиль"></a>
            <hr class="delimiter"/>
            @if(ctx.billBalanceOpt) {
              <a class="left-bar_menu-i __billing@if(leftCurrEl contains LPL_BILLING){ __act}" href="@routes.MarketLkBilling.showAdnNodeBilling(adnId)" title="Биллинг"></a>
              <hr class="delimiter"/>
            }
            <a class="left-bar_menu-i __events@if(leftCurrEl contains LPL_EVENTS){ __act}" href="@routes.LkEvents.nodeIndex(adnId)" title="События">
              @* Вывести блямбу с кол-вом непрочитанных сообщений. *@
              @ctx.nodeUnseenEvtsCnt.map { cnt =>
                @if(cnt > 0) {
                  <span title="Новых событий: @cnt">(@cnt)</span>
                }
              }
            </a>
            <hr class="delimiter"/>
          </nav>
        }
      </aside>

      @adnIdOpt.map { adnId =>
        <a href="@routes.MarketLkAdn.userProfileEdit(adnId)">Редактировать профиль пользователя</a>
      }
      @content

    </section>


  <aside class="popups popups-container" id="popupsContainer">
    @popupContent
  </aside>

  @*<div class="footer">
    <div class="footer_cnt">

      <span class="copyright-block">
        @_copyrightTextTpl(withLink = false)
        &nbsp;|&nbsp;<a class="footer_link@if(leftCurrEl contains LPL_SUPPORT){ __act}"
                        href="@ctx.supportFormCall(adnIdOpt)">Служба поддержки</a>
        <a class="footer_link" href="@routes.Market.contractOfferText("ru")">@Messages("Offer")</a>
      </span>

    </div>
  </div>*@


  <script src="@routes.Assets.versioned("javascripts/lib/bxslider/jquery.bxslider.min.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/market/lk/mx_cof.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/market/lk/mx_dev.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/lib/colorpicker/js/colorpicker.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/lib/lightbox/js/lightbox.min.js")"></script>
  <script src="@routes.Assets.versioned("javascripts/jquery-ui.custom.min.js")"></script>

</body>
}
</html>
