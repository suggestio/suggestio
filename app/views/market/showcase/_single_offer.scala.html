@(ad: MAdT, mmart: MAdnNode, mshopOpt: Option[MAdnNode], isHidden: Boolean = false)(implicit ctx: util.Context)

@import util.TplDataFormatUtil._

<div class="sm-offer sm-sngl-offer @if(isHidden){ sm-hidden-offer }" data-is-mart-offer="@mshopOpt.nonEmpty">

  @ad.panel.map { panelSettings =>
    <div class="offer-header" style="background-color: #@panelSettings.color">
      @mshopOpt.flatMap(_.logoImgOpt).orElse(mmart.logoImgOpt).map { logoImg =>
        <img class="sm-offer-logo" height="30" src="@routes.Img.getImg(logoImg.id)"/>
      }
    </div>
  }

  <div class="offer-details">
    <div class="od-inner">
      @ad.logoImgOpt.map { logoImg =>
        <img class="sm-offer-logo" height="30" src="@routes.Img.getImg(logoImg.id)" alt="@ad.offers.headOption.filter(_.isInstanceOf[AOProduct]).map(_.asInstanceOf[AOProduct].vendor.value)"/>
      }

      @ad.offers.map {
        case adProd: AOProduct => {
          <div class="vendor">@adProd.vendor.value</div>

          @adProd.oldPrice.map { oldPrice =>
            <div class="old-price"><s>@formatPrice(oldPrice.value, oldPrice.currency)</s></div>
          }
          <div class="new-price">@formatPrice(adProd.price.value, adProd.price.currency)</div>
        }

        case adDisco: AODiscount => {
          @adDisco.text1.map { text1 =>
            <div class="disc-text-1" style="color: #@text1.font.color">@text1.value</div>
          }

          <div class="discount template-@adDisco.template.id-@adDisco.template.color " style="color: #@adDisco.discount.font.color">
            @formatPercentRaw(adDisco.discount.value)<span>%</span>
          </div>

          @adDisco.text2.map { text2 =>
            <div class="disc-text-2" style="color: #@text2.font.color">@text2.value</div>
          }
        }

        case adText: AOText => {
          <div class="od-text" style="color: #@adText.text.font.color">@Html(adText.text.value)</div>
        }
      }

      @* Локейшн магазина *@
      @* Если магазин не указан, то значит это рекламная карточка ТЦ. *@
      @mshopOpt.map { mshop =>
        <div class="offer-location">
          <div class="ol-icon"></div>
          @mshop.meta.floor.map { floor =>
            Этаж @floor<br/>
          }
          @mshop.meta.section.map { section =>
            Бутик @section<br/>
          }
          &laquo;@mshop.meta.name&raquo;
        </div>
      }

      @mshopOpt.map { mshop =>
        <a class="sm-button" onclick="siomart.load_for_shop_id('@mshop.id'); return false;" ontouchend="siomart.load_for_shop_id('@mshop.id'); return false;">ПРЕДЛОЖЕНИЯ МАГАЗИНА</a>
      }

    </div>
  </div>

  <img class="poster-photo" data-width="@ad.img.meta.map(_.width).getOrElse(1575)" data-height="@ad.img.meta.map(_.height).getOrElse(1181)" src="@routes.Img.getImg(ad.img.id)"/>

</div>
