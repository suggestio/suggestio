@(args: ScRenderArgs)(implicit ctx: Context)

@* Начальная страница для sio-market. Многочисленные аргументы передаются в контейнере для удобства передачи оных в подшаблоны. *@

@import util.TplDataFormatUtil._

@* Завернуть указанную верстку в ссылку переключения состояния окошка/панени навигации (слева). *@
@toggleNavScrAnchor()(content: Option[ScJsState] => Html) = {
  @defining( args.jsStateOpt.filter(!_.isNavScrOpened) ) { jsStateOpt =>
    @jsStateOpt.map { jsState =>
      <a href="@args.syncUrl(jsState.toggleNavScreen)">
    }
    @content(jsStateOpt)
    @if(jsStateOpt) {
      </a>
    }
  }
}


@* Картинка-приветствие для первого экрана *@
@if(!args.syncRender) {
  @_welcomeScreenTpl(args)
}

@* Основной контейнер, шапка + карточки *@
<div class="sm-focused-ads" id="smFocusedAds" @if(args.focusedContent) {style="display: block;"}>
  @args.focusedContent
</div>

@* Хидер главного экрана *@
<div id="smRootProducerHeader" class="sm-producer-header abs" style="@stuff._bgcolor( args.bgColor )" data-gl-go-back="@args.geoListGoBack.exists(identity)">

  <span id="smRootProducerHeaderButtons">

    @* кнопка выхода (крест) слева наверху. *@
    @if(!args.syncRender) {
      <div class="sm-producer-header_exit-button sm-button sm-producer-header_btn __left-aligned abs" id="smExitButton">
        @svg._exitButtonTpl( args.fgColor )
      </div>
    }

    @* Кнопка доступа к панели навигации по узлам сети. При синхронном рендере её нужно скрывать, если панель уже на экране. *@
    @if(!args.syncRender || !args.jsStateOpt.exists(_.isSomethingOpened)) {
      @toggleNavScrAnchor() { jsStateOpt =>
        <div class="sm-producer-header_geo-button sm-button sm-producer-header_btn __left-aligned abs @if(!args.syncRender || !jsStateOpt) {hidden}" id="smGeoScreenButton">
          @svg._geoFillTpl( args.fgColor )
        </div>
      }
    }

    @* Два прямоугольника слева. Вроде бы закрывают панель поиска справа. Нужно срезать её при синхронном рендере, если правая панель закрыта. *@
    @if(!args.syncRender || args.jsStateOpt.exists(_.isSearchScrOpened)) {
      @args.jsStateOpt.map { jsState =>
        <a href="@args.syncUrl( jsState.copy(searchScrOpenedOpt = None) )">
      }
      <div class="sm-producer-header_index-button sm-button sm-producer-header_btn __left-aligned abs" id="smIndexButton">
        @svg._indexAdsButtonTpl( args.fgColor )
      </div>
      @if(args.jsStateOpt) {
        </a>
      }
    }

    @* Кнопка с 4-мя квадратиками доступа к поисковой панели справа. По дефолту они всегда отображаются, но скрыты в остальных случаях. *@
    @if(!args.syncRender || !args.jsStateOpt.exists(_.isAnyPanelOpened)) {
      @args.jsStateOpt.map { jsState =>
        <a href="@args.syncUrl( jsState.copy(searchScrOpenedOpt = Some(true), navScrOpenedOpt = None, tilesCatIdOpt = None, fadsProdIdOpt = None) )">
      }
      <div class="sm-producer-header_search-button sm-button sm-producer-header_btn __right-aligned abs" id="smNavigationLayerButton">
        @svg._navLayerButtonTpl( args.fgColor )
      </div>
      @if(args.jsStateOpt) {
       </a>
      }
    }

  </span>

  @toggleNavScrAnchor() { jsStateOpt =>
    <span class="sm-producer-header_txt-logo" style="color: #@args.fgColor; border-color: #@args.fgColor;">
      @args.name
      <span class="sm-producer-header_txt-logo-dot __left" style="background: #@args.fgColor;"></span>
      <span class="sm-producer-header_txt-logo-dot __right" style="background: #@args.fgColor;"></span>
    </span>
  }

  <div class="sm-producer-header_icon">
    @svg._catHeaderIcon( args.fgColor )
  </div>

</div>

@* Работа с сеткой карточек *@
@_gridAdsTpl(args)

@* Окно с выбором категорий *@
@if(!args.syncRender || args.jsStateOpt.exists(_.isSearchScrOpened)) {
  @_categories_w_search(args)
}

@* Окно с предупреждением о выходе из Sio.Market *@
@if(!args.syncRender) {
  @_exit_screen(args)
}

@* Окно с версткой гео-меню *@
@if( !args.syncRender || args.jsStateOpt.exists(_.isNavScrOpened) ) {
  @_geo_screen(args)
}

@if(!args.syncRender) {
  <div id="fsLoaded" class="fs-loader" style="background: rgba( @{colorHex2rgb( args.bgColor ).mkString(",")}, 0.3);">
    <div class="fs-loader_spinner">@svg._spinnerTpl(args.fgColor)</div>
  </div>
}

<div class="sm-loading" id="smLoading"></div>
