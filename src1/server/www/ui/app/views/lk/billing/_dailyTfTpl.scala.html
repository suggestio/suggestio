@(args: mbill.IDailyTfTplArgs)(implicit ctx: Context)

@import ctx._
@import util.TplDataFormatUtil._
@import io.suggest.cal.m.MCalTypes

<div class="tariff_illustration-w">
  <div class="tariff_illustration"></div>
</div>

<div class="ovh">

  <table class="tariff_info">

    @* Строка-заголовок. *@
    <tr>
      <td colspan="2">&nbsp;</td>
      @for( clause <- args.dailyTf.clauses.valuesIterator) {
        @* Из-за "особенностей" верстки макса требуется добавлять пустые ячейки между столбцами. *@
        @if( !clause.eq( args.dailyTf.clauses.head._2 ) ) {
          <td></td>
        }
        <td class="td tariff_info-title">
          @* По календарю определить тип и слова для рендера. *@
          @defining( clause.calId.flatMap(args.calsMap.get).map(_.calType).getOrElse(MCalTypes.default) ) { mct =>
            @messages(mct.name):
            @for(dayStart <- mct.dayStart; dayEnd <- mct.dayEnd) {
              @messages("dow." + dayStart)-@messages("dow." + dayEnd)
            }
          }
        </td>
      }
    </tr>

    @* Строка с ценами. *@
    <tr>
      <td class="td tariff_green ft-XS white">
        @Html( messages("Minimal.module", "&nbsp;") )
        <br/>
        (@Html( messages("scheme.left", "&nbsp") ))
      </td>
      <td class="td"></td>
      @defining( args.dailyTf.currency ) { currency =>
      @defining( messages("day24h") ) { sutkiI18n =>

        @for( clause <- args.dailyTf.clauses.valuesIterator) {
          @if( !clause.eq( args.dailyTf.clauses.head._2 ) ) {
            <td class="td"></td>
          }
          <td class="td tariff_info-value">
            @formatPrice(clause.amount, currency)/@sutkiI18n
          </td>
        }

      } @* Слово "сутки" на текущем языке. *@
      } @* закешированный инстанс currency *@
    </tr>

    @* Строка-футер с малополезным пояснением. *@
    <tr>
      <td colspan="2"></td>
      <td class="td light-gray ft-XS" colspan="5">
        @* Рендер предложения "по соглашению с СВСА установлены тарифы.
           toString у года нужен, чтобы не было непонятного пробела после первой двойки. *@
        @messages(
          "Agreement.btw.CBCA.and.node.tariffs.for.year",
          messages( AdnShownTypes.node2val(args.mnode).singular ),
          args.mnode.meta.basic.name,
          ctx.now.getYear.toString
        )
      </td>
    </tr>

  </table>

</div>
