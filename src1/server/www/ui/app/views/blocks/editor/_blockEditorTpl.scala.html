@(af: blk.ed.AdFormM, withBC: Option[BlockConf] = None)(implicit ctx: Context)

@import util.blocks._
@import io.suggest.ad.form.AdFormConstants._
@import lk.dsl._

@defining( OFFER_K ) { nameBase =>
  @defining(withBC getOrElse BlocksConf.DEFAULT) { bc =>

    <div class="ad-block-editor">
      @for(bf <- bc.blockFields(af)) {

        <div class="edit-ad_block-field __@bf.name js-ad-editor_field-@bf.name">
          @defining( nameBase + bf.offerNopt.map(".offer[" + _ + "]").getOrElse("") + ".") { bfNamePrefix =>
            @bf.renderEditorField(
              af = af,
              bfNameBase = bfNamePrefix + bf.name,
              bc = bc
            )
            @* Скрытые поля с координатами. *@
            @if( bf.withCoords ) {
              @for( coordName <- "x" :: "y" :: Nil;  xname = bfNamePrefix + "coords." + coordName ) {
                <input type="hidden" name="@xname" value="@af(xname).value"/>
              }
            }
          }
        </div>

        @if(bf.name == "bgImg" || bf.name == "addTextField") {
	        @_delimTpl()
        }

      }

      @* Исходный id блока. Необходим при переключении блоков. *@
      <input type="hidden" name="@{nameBase}.oldBlockId" value="@bc.id"/>

      @* Новый/текущий id блока. При переключении сюда втыкается новый id блока и происходит submit для получения новой формы. *@
      <input type="hidden" name="@{nameBase}.blockId" value="@bc.id"/>

    </div>

  }
}
