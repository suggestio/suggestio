@(args: mlk.INodeAdsTplArgs)(implicit ctx: Context)

@* Список рекламных карточек для создателя рекламы. В нём галочки есть. *@
@import adv._
@import views.html.lk.ad._
@import ctx._
@import args._
@import ctx.api.{n2NodesUtil => n2n}


@_adsListOuterTpl {

  <a class="add-adv-btn f-left" href="@routes.LkAdEdit.createAd(mnode.id.get)">
    <span>@Html( messages("Create.ad", "<br/>") )</span>
  </a>

  @for( (mnai, i) <- args.mads.iterator.zipWithIndex ) {
    @_adInListTpl(mnai.brArgs, i + 1) {
      <div class="js-equal-height">

        @* Отображать индикацию размещенности карточки. *@
        @if( mnai.isBusy ) {
          <span class="adv-item_status @if(mnai.isReq){__request} @if(mnai.isApproved){__ok}"></span>
        }

        @* Карточку можно редактировать всегда. Раньше нельзя было редактировать размещенную. *@
        <a class="adv-item_edit-btn" href="@routes.LkAdEdit.editAd(mnai.mad.id.get)">
          <span></span>
        </a>

        @* Галочка для управления отображением рекламной карточки магазина.
           Отображается, если текущий узел допускает размещение своих карточек... *@
        @if(canAdv) {
          @* и если модератор не препятствует бесплатному размещению этой карточки. *@
          @n2n.mdrs(mnai.mad).toStream.headOption.fold {

            @* Бесплатное размещение не запрещено. *@
            <div class="ads-list-block__controls">
              @* Обходим данные по out-уровня, превращая её в список галочек. *@
              <label>
                <input class="checkbox" type="checkbox"
                       data-level="a" data-adid="@mnai.mad.id"
                       @if(!args.canAdv) {disabled="disabled"}
                       @if( mnode.id.flatMap(n2n.findReceiver(mnai.mad, _)).nonEmpty ) {checked="checked"} />
                <span class="styled-checkbox"></span>&nbsp;@messages("Show._ad")
              </label>
            </div>
          } { faMdr =>
            @* Модератор запретил бесплатное размещение указанное карточки. *@
            @faMdr.info.commentNi
          }
        }

      </div> @* js-equal-height *@

      @if(canAdv) {
        <a class="btn __size-XM __radial-major" href="@routes.LkAdvGeo.forAd(mnai.mad.id.get)">
          @messages("ad.Manage")
        </a>
      }

    }
  }

  <div class="clear"></div>

}
